(()=>{var e={};e.id=2940,e.ids=[2940],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},67691:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>x,tree:()=>d}),s(30101),s(95499),s(72110),s(35866);var r=s(23191),a=s(88716),n=s(37922),l=s.n(n),i=s(95231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let d=["",{children:["settings",{children:["whatsapp",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,30101)),"C:\\vyaparconnect-crm\\src\\app\\settings\\whatsapp\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,95499)),"C:\\vyaparconnect-crm\\src\\app\\layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,72110)),"C:\\vyaparconnect-crm\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\vyaparconnect-crm\\src\\app\\settings\\whatsapp\\page.tsx"],p="/settings/whatsapp/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/settings/whatsapp/page",pathname:"/settings/whatsapp",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},92057:(e,t,s)=>{Promise.resolve().then(s.bind(s,68374))},63062:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(62881).Z)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},12714:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(62881).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},31215:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(62881).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},68374:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var r=s(10326),a=s(17577),n=s(77109),l=s(41291),i=s(63062),o=s(77506),d=s(31215),c=s(62881);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,c.Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),u=(0,c.Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);var x=s(12714),m=s(30058),h=s(79375),g=s(90434),y=s(28676);let b={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:100}}},k=()=>{let{data:e}=(0,n.useSession)(),[t,s]=(0,a.useState)({}),[c,k]=(0,a.useState)(!0),[j,f]=(0,a.useState)(!1),[v,w]=(0,a.useState)(""),[N,C]=(0,a.useState)(""),[S,P]=(0,a.useState)(""),[A,T]=(0,a.useState)(!1),[M,Z]=(0,a.useState)(!1),[_,E]=(0,a.useState)(""),[q,z]=(0,a.useState)(""),[I,O]=(0,a.useState)(!1),[R,V]=(0,a.useState)(null);(0,a.useEffect)(()=>{let t=window.location.origin;e?.user?.id&&P(`${t}/api/webhooks/whatsapp?uid=${e.user.id}`),T(t.includes("localhost")||t.includes("127.0.0.1")),(async()=>{k(!0);try{let e=await fetch("/api/settings/whatsapp");if(!e.ok)throw Error("Failed to load settings.");let t=await e.json();s(t)}catch(e){w(e.message)}finally{k(!1)}})()},[e?.user?.id]);let B=e=>{let{name:t,value:r}=e.target;s(e=>({...e,[t]:r}))},U=async e=>{e.preventDefault(),f(!0),w(""),C("");try{let e=await fetch("/api/settings/whatsapp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await e.json();if(!e.ok)throw Error(r.error||"Failed to save settings.");s(r),C("Settings saved successfully!"),setTimeout(()=>C(""),3e3)}catch(e){w(e.message)}finally{f(!1)}},F=async()=>{O(!0),z("");try{let e=await fetch("/api/settings/reveal-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:_})}),t=await e.json();if(!e.ok)throw Error(t.error||"Verification failed");V(t.token),Z(!1),E("")}catch(e){z(e.message)}finally{O(!1)}},L=(e,t)=>{navigator.clipboard.writeText(e);let s=document.getElementById(t);if(s){let e=s.innerText;s.innerText="Copied!",setTimeout(()=>{s.innerText=e},1500)}};return c?r.jsx("div",{className:"p-8 flex items-center justify-center h-full",children:r.jsx(h.Z,{})}):(0,r.jsxs)("div",{className:"p-6 md:p-8 bg-gray-50/50 dark:bg-gray-900/50 min-h-screen",children:[r.jsx(g.default,{href:"/settings",className:"text-sm text-blue-600 hover:underline mb-4 inline-block",children:"← Back to Settings"}),r.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"WhatsApp Setup"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Connect your WhatsApp Business Account to start messaging."}),(0,r.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto space-y-8",children:[v&&(0,r.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md flex items-center",children:[r.jsx(l.Z,{className:"h-5 w-5 mr-3"}),r.jsx("span",{children:v})]}),N&&r.jsx("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-md",children:r.jsx("p",{children:N})}),(0,r.jsxs)(m.E.div,{variants:b,className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100/50 dark:border-gray-700/50",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Step 1: Enter Your API Credentials"}),(0,r.jsxs)("div",{className:"p-3 bg-blue-50 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 rounded-md text-sm flex items-start mb-4",children:[r.jsx(i.Z,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("span",{children:["Find these credentials in your ",r.jsx("a",{href:"https://developers.facebook.com/apps/",target:"_blank",rel:"noopener noreferrer",className:"font-bold underline",children:"Meta for Developers App"})," under ",r.jsx("code",{className:"bg-black/10 px-1 rounded",children:"WhatsApp > API Setup"}),"."]})]}),(0,r.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Phone Number ID"}),r.jsx("input",{type:"text",name:"whatsappPhoneNumberId",value:t.whatsappPhoneNumberId||"",onChange:B,className:"w-full border rounded-md p-2 mt-1 dark:bg-gray-700 dark:border-gray-600",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Business Account ID"}),r.jsx("input",{type:"text",name:"whatsappBusinessAccountId",value:t.whatsappBusinessAccountId||"",onChange:B,className:"w-full border rounded-md p-2 mt-1 dark:bg-gray-700 dark:border-gray-600",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Permanent Access Token"}),r.jsx("input",{type:"password",name:"whatsappAccessToken",value:t.whatsappAccessToken||"",onChange:B,onFocus:e=>{e.target.value.startsWith("•")&&s(e=>({...e,whatsappAccessToken:""}))},placeholder:"Enter a new token to update it",className:"w-full border rounded-md p-2 mt-1 dark:bg-gray-700 dark:border-gray-600"})]}),r.jsx("div",{className:"flex justify-end pt-2",children:(0,r.jsxs)("button",{type:"submit",disabled:j,className:"flex items-center justify-center px-6 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 disabled:opacity-50",children:[j?r.jsx(o.Z,{className:"animate-spin mr-2"}):r.jsx(d.Z,{className:"mr-2"}),j?"Saving...":"Save Credentials"]})})]})]}),(0,r.jsxs)(m.E.div,{variants:b,className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100/50 dark:border-gray-700/50",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Step 2: Configure Webhook in Meta"}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Copy the following values and paste them into your Meta App's webhook configuration page."}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Callback URL"}),(0,r.jsxs)("div",{className:"flex items-center mt-1",children:[r.jsx("input",{type:"text",value:S,readOnly:!0,className:"w-full border rounded-l-md p-2 bg-gray-100 dark:bg-gray-700/50 font-mono text-xs"}),r.jsx("button",{type:"button",id:"copy-url-btn",onClick:()=>L(S,"copy-url-btn"),className:"p-2 border border-l-0 rounded-r-md bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500",children:r.jsx(p,{size:16})})]}),A&&(0,r.jsxs)("div",{className:"mt-2 p-3 bg-yellow-50 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-md text-sm flex items-start",children:[r.jsx(l.Z,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("span",{children:[r.jsx("strong",{children:"Action Required:"})," You are on a local server. Meta's webhooks cannot reach this URL. Use a tunneling service like ",r.jsx("a",{href:"https://ngrok.com/",target:"_blank",rel:"noopener noreferrer",className:"font-bold underline",children:"ngrok"})," to get a public HTTPS URL. Then, paste that public URL (e.g., ",(0,r.jsxs)("code",{children:["https://<your-ngrok-id>.ngrok.io/api/webhooks/whatsapp?uid=",e?.user.id]}),") into your Meta App's webhook configuration."]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Verify Token"}),(0,r.jsxs)("div",{className:"flex items-center mt-1",children:[r.jsx("input",{type:"text",value:R||"••••••••••••••••••••••••••••••••••••",readOnly:!0,className:"w-full border rounded-l-md p-2 bg-gray-100 dark:bg-gray-700/50 font-mono text-xs"}),R?r.jsx("button",{type:"button",onClick:()=>V(null),className:"p-2 border border-l-0 rounded-r-md bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500",children:r.jsx(u,{size:16})}):r.jsx("button",{type:"button",onClick:()=>Z(!0),className:"p-2 border border-l-0 rounded-r-md bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500",children:r.jsx(x.Z,{size:16})}),r.jsx("button",{type:"button",id:"copy-token-btn",onClick:()=>R&&L(R,"copy-token-btn"),disabled:!R,className:"p-2 border border-l-0 rounded-r-md bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed",children:r.jsx(p,{size:16})})]}),(0,r.jsxs)("div",{className:"mt-2 p-3 bg-gray-50 dark:bg-gray-900/30 border dark:border-gray-700 rounded-md text-sm text-gray-600 dark:text-gray-300 space-y-2",children:[r.jsx("p",{className:"font-semibold",children:"Next Steps:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside space-y-1",children:[(0,r.jsxs)("li",{children:["Copy the user-specific ",r.jsx("span",{className:"font-bold",children:"Callback URL"})," above."]}),(0,r.jsxs)("li",{children:["Click the ",r.jsx(x.Z,{size:14,className:"inline-block mx-1"})," icon, enter your password to reveal your secure ",r.jsx("span",{className:"font-bold",children:"Verify Token"}),", then copy it."]}),r.jsx("li",{children:"Paste both values into their corresponding fields in your Meta App's webhook configuration."})]})]})]})]})]})]}),r.jsx(y.Z,{isOpen:M,onClose:()=>Z(!1),title:"Enter Password to Reveal Token",children:(0,r.jsxs)("div",{className:"space-y-4",children:[q&&r.jsx("p",{className:"text-red-500 text-sm",children:q}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"For your security, please enter your login password to continue."}),r.jsx("input",{type:"password",value:_,onChange:e=>E(e.target.value),className:"w-full border rounded-md p-2 dark:bg-gray-700 dark:border-gray-600",placeholder:"Your password"}),r.jsx("div",{className:"flex justify-end",children:(0,r.jsxs)("button",{onClick:F,disabled:I,className:"flex items-center justify-center px-4 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 disabled:opacity-50",children:[I?r.jsx(o.Z,{className:"animate-spin mr-2"}):null,"Verify"]})})]})})]})}},28676:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(10326);s(17577);let a=({isOpen:e,onClose:t,title:s,children:a})=>e?r.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",onClick:t,children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md m-4",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:s}),r.jsx("button",{onClick:t,className:"text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:"\xd7"})]}),r.jsx("div",{className:"p-4",children:a})]})}):null},30101:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>n,default:()=>i});var r=s(68570);let a=(0,r.createProxy)(String.raw`C:\vyaparconnect-crm\src\app\settings\whatsapp\page.tsx`),{__esModule:n,$$typeof:l}=a;a.default;let i=(0,r.createProxy)(String.raw`C:\vyaparconnect-crm\src\app\settings\whatsapp\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,737,9393],()=>s(67691));module.exports=r})();