"use strict";(()=>{var e={};e.id=4547,e.ids=[4547],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},89908:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{POST:()=>p});var n=r(49303),o=r(88716),i=r(60670),s=r(87070),u=r(20728);async function p(e,t){let{default:a}=await Promise.all([r.e(9092),r.e(1212)]).then(r.t.bind(r,41212,23)),n=process.env.RAZORPAY_KEY_ID||"",o=process.env.RAZORPAY_KEY_SECRET||"";if(!n||!o)return s.NextResponse.json({error:"Razorpay keys are not configured in environment variables."},{status:500});let i=new a({key_id:n,key_secret:o}),{id:p}=await t.params;try{let e=await u.Z.quotation.findUnique({where:{id:p}});if(!e)return s.NextResponse.json({error:"Quotation not found"},{status:404});let t=await i.paymentLink.create({amount:Math.round(100*e.total),currency:"INR",description:`Payment for Quotation #${e.id}`,customer:{name:e.customerName,contact:e.contactNumber},notify:{sms:!0,email:!1},reminder_enable:!0,notes:{quotation_id:e.id},callback_url:"https://e3e2fbab318c.ngrok-free.app/payment-success",callback_method:"get"});return await u.Z.quotation.update({where:{id:p},data:{paymentLinkId:t.id,paymentLinkUrl:t.short_url}}),s.NextResponse.json({success:!0,paymentLinkUrl:t.short_url})}catch(e){return console.error("Failed to create Razorpay payment link:",e),s.NextResponse.json({error:e.message||"Failed to create payment link"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/quotations/[id]/create-payment-link/route",pathname:"/api/quotations/[id]/create-payment-link",filename:"route",bundlePath:"app/api/quotations/[id]/create-payment-link/route"},resolvedPagePath:"C:\\vyaparconnect-crm\\src\\app\\api\\quotations\\[id]\\create-payment-link\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:m}=c,q="/api/quotations/[id]/create-payment-link/route";function y(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},20728:(e,t,r)=>{r.d(t,{Z:()=>n});let a=require("@prisma/client"),n=globalThis.prisma||new a.PrismaClient}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972],()=>r(89908));module.exports=a})();