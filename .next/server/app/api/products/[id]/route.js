"use strict";(()=>{var e={};e.id=3898,e.ids=[3898],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},966:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>h,routeModule:()=>l,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m});var o={};r.r(o),r.d(o,{DELETE:()=>c,GET:()=>d,PUT:()=>p});var a=r(49303),n=r(88716),s=r(60670),i=r(87070),u=r(20728);async function d(e,t){try{let{id:e}=await t.params,r=await u.Z.product.findUnique({where:{id:e},include:{images:!0}});if(!r)return i.NextResponse.json({error:"Product not found"},{status:404});return i.NextResponse.json(r)}catch(e){return console.error("GET /api/products/[id] error",e),i.NextResponse.json({error:"Failed to fetch product"},{status:500})}}async function p(e,t){try{let{id:r}=await t.params,{name:o,description:a,price:n,imagesToAdd:s,imagesToDelete:d,category:p,inStock:c,stockQuantity:l,workflow:h}=await e.json(),m={};void 0!==o&&(m.name=o),void 0!==a&&(m.description=a),null!=n&&(m.price="string"==typeof n?parseFloat(n):n),void 0!==p&&(m.category=p),void 0!==c&&(m.inStock=c),void 0!==h&&(m.workflow=h),null!=l&&(m.stockQuantity="string"==typeof l?parseInt(l,10):l),await u.Z.$transaction(async e=>{Object.keys(m).length>0&&await e.product.update({where:{id:r},data:m}),Array.isArray(d)&&d.length>0&&await e.productImage.deleteMany({where:{productId:r,id:{in:d}}}),Array.isArray(s)&&s.length>0&&await e.productImage.createMany({data:s.map(e=>({url:e,productId:r}))})});let w=await u.Z.product.findUnique({where:{id:r},include:{images:!0}});return i.NextResponse.json(w)}catch(e){return console.error("PUT /api/products/[id] error",e),i.NextResponse.json({error:"Failed to update product"},{status:500})}}async function c(e,t){try{let{id:e}=await t.params,r=await u.Z.quotationItem.count({where:{productId:e}});if(r>0)return i.NextResponse.json({error:`Cannot delete. This product is used in ${r} quotation(s).`},{status:409});return await u.Z.$transaction([u.Z.message.updateMany({where:{productId:e},data:{productId:null}}),u.Z.productImage.deleteMany({where:{productId:e}}),u.Z.product.delete({where:{id:e}})]),i.NextResponse.json({success:!0},{status:200})}catch(e){if(console.error("DELETE /api/products/[id] error",e),"P2025"===e.code)return i.NextResponse.json({error:"Product not found"},{status:404});return i.NextResponse.json({error:"An unexpected error occurred while deleting the product."},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"C:\\vyaparconnect-crm\\src\\app\\api\\products\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:w}=l,y="/api/products/[id]/route";function g(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},20728:(e,t,r)=>{r.d(t,{Z:()=>a});let o=require("@prisma/client"),a=globalThis.prisma||new o.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972],()=>r(966));module.exports=o})();