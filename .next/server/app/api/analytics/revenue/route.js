"use strict";(()=>{var e={};e.id=3394,e.ids=[3394],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},36351:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{GET:()=>c});var s=r(49303),n=r(88716),i=r(60670),o=r(87070),u=r(20728),l=r(95456);let p=e=>{let t=new Date(e);return t.setHours(0,0,0,0),t},d=e=>{let t=new Date(e);return t.setHours(23,59,59,999),t};async function c(e){let t=await (0,l.P)();if(!t?.user?.id)return o.NextResponse.json({error:"Not authenticated"},{status:401});let r=t.user.id,{searchParams:a}=new URL(e.url),s=a.get("from"),n=a.get("to");if(!s||!n)return o.NextResponse.json({error:"Date range is required"},{status:400});try{let e=p(new Date(s)),t=d(new Date(n)),a=await u.Z.payment.findMany({where:{createdAt:{gte:e,lte:t},OR:[{order:{userId:r}},{quotation:{userId:r}}],status:"PAID"},select:{amount:!0,createdAt:!0},orderBy:{createdAt:"asc"}}),i={},l=new Date(e),c=(t.getTime()-e.getTime())/864e5;for(;l<=t;)i[l.toISOString().split("T")[0]]=0,l.setDate(l.getDate()+1);a.forEach(e=>{let t=e.createdAt.toISOString().split("T")[0];void 0!==i[t]&&(i[t]+=e.amount)});let m=Object.keys(i).map(e=>{let t=new Date(e);return{label:c>7?t.toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"}):t.toLocaleDateString("en-US",{weekday:"short",timeZone:"UTC"}),value:i[e],date:e}}).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).map(({date:e,...t})=>t);return o.NextResponse.json(m)}catch(e){return console.error("GET /api/analytics/revenue error",e),o.NextResponse.json({error:"Failed to fetch revenue data"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/revenue/route",pathname:"/api/analytics/revenue",filename:"route",bundlePath:"app/api/analytics/revenue/route"},resolvedPagePath:"C:\\vyaparconnect-crm\\src\\app\\api\\analytics\\revenue\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:w,serverHooks:y}=m,x="/api/analytics/revenue/route";function h(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},95456:(e,t,r)=>{r.d(t,{L:()=>l,P:()=>p});var a=r(45609),s=r(53797),n=r(13539),i=r(20728),o=r(67096),u=r.n(o);let l={adapter:(0,n.N)(i.Z),providers:[(0,s.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e.password)return null;let t=await i.Z.user.findUnique({where:{email:e.email}});return t&&t.password&&await u().compare(e.password,t.password)?{id:t.id,name:t.name,email:t.email}:null}})],session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,callbacks:{session:async({token:e,session:t})=>(e&&t.user&&(t.user.id=e.id,t.user.name=e.name,t.user.email=e.email,t.user.hasCompletedOnboarding=e.hasCompletedOnboarding,t.user.primaryWorkflow=e.primaryWorkflow),t),async jwt({token:e,user:t}){let r=t?.id||e.sub;if(!r)return e;let a=await i.Z.user.findUnique({where:{id:r},select:{id:!0,name:!0,email:!0,hasCompletedOnboarding:!0,settings:{select:{primaryWorkflow:!0}}}});return a?{...e,id:a.id,name:a.name,email:a.email,hasCompletedOnboarding:a.hasCompletedOnboarding,primaryWorkflow:a.settings?.primaryWorkflow||"HYBRID"}:e}},pages:{signIn:"/login"}},p=()=>(0,a.getServerSession)(l)},20728:(e,t,r)=>{r.d(t,{Z:()=>s});let a=require("@prisma/client"),s=globalThis.prisma||new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,1184],()=>r(36351));module.exports=a})();