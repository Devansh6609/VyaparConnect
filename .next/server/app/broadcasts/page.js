(()=>{var e={};e.id=2267,e.ids=[2267],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16260:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>d.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>p,tree:()=>c}),a(36277),a(95499),a(72110),a(35866);var s=a(23191),r=a(88716),l=a(37922),d=a.n(l),n=a(95231),i={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>n[e]);a.d(t,i);let c=["",{children:["broadcasts",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,36277)),"C:\\vyaparconnect-crm\\src\\app\\broadcasts\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,95499)),"C:\\vyaparconnect-crm\\src\\app\\layout.tsx"],loading:[()=>Promise.resolve().then(a.bind(a,72110)),"C:\\vyaparconnect-crm\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\vyaparconnect-crm\\src\\app\\broadcasts\\page.tsx"],x="/broadcasts/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/broadcasts/page",pathname:"/broadcasts",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},97430:(e,t,a)=>{Promise.resolve().then(a.bind(a,45682))},83855:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(62881).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},45682:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var s=a(10326),r=a(17577),l=a(83855),d=a(92717),n=a(79375),i=a(64590),c=a(28676);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,a(62881).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var x=a(77506),m=a(69436),p=a(45597);let u=({isOpen:e,onClose:t,onSuccess:a})=>{let[l,d]=(0,r.useState)([]),[n,i]=(0,r.useState)([]),[u,h]=(0,r.useState)(""),[g,y]=(0,r.useState)(""),[b,j]=(0,r.useState)(null),[f,N]=(0,r.useState)(!1),[v,w]=(0,r.useState)("");(0,r.useEffect)(()=>{e&&((async()=>{let e=await fetch("/api/tags");e.ok&&d(await e.json())})(),i([]),h(""),y(""),w(""),j(null))},[e]);let k=async e=>{if(e.preventDefault(),0===n.length){w("Please select at least one target tag.");return}if(!b&&!g){w("A Template Name is required for text-only broadcasts.");return}N(!0),w("");try{let e=await fetch("/api/broadcasts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tagIds:n,message:u,templateId:g,imageUrl:b})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to send broadcast.");a()}catch(e){w(e.message)}finally{N(!1)}};return s.jsx(c.Z,{isOpen:e,onClose:t,title:"Create New Broadcast",children:(0,s.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[v&&s.jsx("p",{className:"text-red-600 bg-red-50 p-2 rounded-md text-sm",children:v}),(0,s.jsxs)("div",{className:"p-3 bg-yellow-50 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-md text-sm flex items-start",children:[s.jsx(o,{className:"w-8 h-8 mr-2 flex-shrink-0"}),(0,s.jsxs)("span",{children:[s.jsx("b",{children:"Important:"})," To comply with WhatsApp policies, you must send a pre-approved Meta Template Message for text-only broadcasts."]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium",children:"Target Audience (Tags)"}),s.jsx("div",{className:"mt-2 border rounded-md max-h-32 overflow-y-auto p-2 space-y-1",children:l.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2 p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:n.includes(e.id),onChange:()=>i(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),className:"h-4 w-4 text-blue-600 rounded"}),s.jsx("span",{className:"text-sm",children:e.name})]},e.id))})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium",children:"Image (Optional)"}),s.jsx("div",{className:"mt-1",children:s.jsx(p.Z,{onUpload:e=>j(e),initialUrl:b})})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"template-id",className:"flex items-center text-sm font-medium",children:"Template Name / ID"}),s.jsx("input",{id:"template-id",type:"text",value:g,onChange:e=>y(e.target.value),required:!b,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g., hello_world (required if no image)"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"message",className:"text-sm font-medium",children:"Message Content / Caption"}),s.jsx("textarea",{id:"message",value:u,onChange:e=>h(e.target.value),rows:4,required:!0,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600",placeholder:b?"Enter a caption for your image...":"This message text must EXACTLY match your approved template content."})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[s.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md",children:"Cancel"}),(0,s.jsxs)("button",{type:"submit",disabled:f,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md disabled:opacity-50 flex items-center",children:[f?s.jsx(x.Z,{className:"animate-spin mr-2"}):s.jsx(m.Z,{size:16,className:"mr-2"}),"Send Broadcast"]})]})]})})};var h=a(90434),g=a(30058),y=a(88129);let b=()=>{let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)(!0),[o,x]=(0,r.useState)(!1),m=(0,r.useCallback)(async()=>{c(!0);try{let e=await fetch("/api/broadcasts");e.ok&&t(await e.json())}catch(e){console.error("Failed to fetch broadcasts",e)}finally{c(!1)}},[]);return((0,r.useEffect)(()=>{m()},[m]),a)?s.jsx("div",{className:"p-8 text-center flex items-center justify-center h-full",children:s.jsx(n.Z,{})}):(0,s.jsxs)("div",{className:"p-6 md:p-8 dark:bg-gray-900/50 min-h-full",children:[(0,s.jsxs)(g.E.div,{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Broadcasts"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Send campaigns to tagged groups of customers."})]}),(0,s.jsxs)("button",{onClick:()=>x(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md flex items-center shadow-sm hover:bg-blue-700",children:[s.jsx(l.Z,{size:16,className:"mr-2"})," New Broadcast"]})]}),0===e.length?(0,s.jsxs)("div",{className:"text-center py-20 border-2 border-dashed rounded-lg",children:[s.jsx(d.Z,{size:48,className:"mx-auto text-gray-400"}),s.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-800 dark:text-gray-200",children:"No Broadcasts Sent"}),s.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Click 'New Broadcast' to create your first campaign."})]}):s.jsx(g.E.div,{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 overflow-hidden",children:(0,s.jsxs)("table",{className:"min-w-full",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recipients"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sent At"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx(g.E.tbody,{className:"divide-y dark:divide-gray-700",children:s.jsx(y.M,{children:e.map(e=>(0,s.jsxs)(g.E.tr,{children:[s.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:s.jsx("p",{className:"text-sm truncate max-w-xs",children:e.message})}),s.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:e.status}),s.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:e._count?.recipients||0}),s.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(0,i.WU)(new Date(e.sentAt),"PPp")}),s.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:s.jsx(h.default,{href:`/broadcasts/${e.id}`,className:"text-blue-600 hover:underline",children:"View"})})]},e.id))})})]})}),s.jsx(u,{isOpen:o,onClose:()=>x(!1),onSuccess:()=>{x(!1),m()}})]})}},45597:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var s=a(10326),r=a(17577),l=a(77506);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,a(62881).Z)("CloudUpload",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]),n=({initialUrl:e,onUpload:t,isQrCode:a=!1})=>{let[n,i]=(0,r.useState)(e),[c,o]=(0,r.useState)(!1),[x,m]=(0,r.useState)(""),p=async e=>{let a=e.target.files?.[0];if(a){o(!0),m("");try{let e=new FormData;e.append("file",a);let s=await fetch("/api/uploads/file",{method:"POST",body:e}),r=await s.json();if(!s.ok)throw Error(r.error||"Upload failed");i(r.url),t(r.url)}catch(e){m(e.message)}finally{o(!1)}}};return(0,s.jsxs)("div",{children:[n?(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[s.jsx("img",{src:n,alt:"preview",className:`border rounded-md p-1 bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 ${a?"h-32 w-32":"h-16"} object-contain`}),(0,s.jsxs)("label",{className:"text-sm font-medium text-blue-600 hover:text-blue-700 cursor-pointer",children:["Change",s.jsx("input",{type:"file",accept:"image/png, image/jpeg",onChange:p,className:"hidden"})]})]}):s.jsx("label",{className:"w-full flex flex-col items-center justify-center px-4 py-6 bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:c?(0,s.jsxs)(s.Fragment,{children:[s.jsx(l.Z,{className:"animate-spin h-8 w-8"}),s.jsx("span",{className:"mt-2 text-sm font-medium",children:"Uploading..."})]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(d,{className:"h-8 w-8"}),s.jsx("span",{className:"mt-2 text-sm font-medium",children:"Click to upload"}),s.jsx("span",{className:"text-xs",children:"PNG or JPG"}),s.jsx("input",{type:"file",accept:"image/png, image/jpeg",onChange:p,className:"hidden"})]})}),x&&s.jsx("p",{className:"text-xs text-red-500 mt-1",children:x})]})}},28676:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});var s=a(10326);a(17577);let r=({isOpen:e,onClose:t,title:a,children:r})=>e?s.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",onClick:t,children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md m-4",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:a}),s.jsx("button",{onClick:t,className:"text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:"\xd7"})]}),s.jsx("div",{className:"p-4",children:r})]})}):null},36277:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>d,__esModule:()=>l,default:()=>n});var s=a(68570);let r=(0,s.createProxy)(String.raw`C:\vyaparconnect-crm\src\app\broadcasts\page.tsx`),{__esModule:l,$$typeof:d}=r;r.default;let n=(0,s.createProxy)(String.raw`C:\vyaparconnect-crm\src\app\broadcasts\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[8948,4890,7344,4590,1833],()=>a(16260));module.exports=s})();