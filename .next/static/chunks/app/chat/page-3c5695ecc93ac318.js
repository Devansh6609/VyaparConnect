(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{6190:function(e,t,a){Promise.resolve().then(a.bind(a,1451))},2513:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(8030).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},9061:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(8030).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},1451:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eG}});var r=a(7437),s=a(2265),l=a(6463),d=a(6563),n=a(1065),i=a(1339);let o=()=>(0,r.jsxs)("div",{className:"flex items-center p-3",children:[(0,r.jsx)(i.Z,{className:"h-10 w-10 rounded-full"}),(0,r.jsxs)("div",{className:"ml-3 flex-1",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(i.Z,{className:"h-4 w-2/4"}),(0,r.jsx)(i.Z,{className:"h-3 w-1/4"})]}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(i.Z,{className:"h-3 w-3/4"})})]})]});var c=()=>(0,r.jsx)("div",{className:"pt-2",children:[...Array(8)].map((e,t)=>(0,r.jsx)(o,{},t))}),u=a(9788),m=a(1513),x=a(4446);let g={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.07,delayChildren:.1}}},h={hidden:{y:20,opacity:0},visible:{y:0,opacity:1},exit:{opacity:0,x:-30,transition:{duration:.2}}};var y=e=>{let{socket:t,activeContactId:a,onSelectChat:l}=e,[i,o]=(0,s.useState)([]),[y,b]=(0,s.useState)(!0),[p,f]=(0,s.useState)(""),[j,v]=(0,s.useState)(null),[k,N]=(0,s.useState)(!0),[w,D]=(0,s.useState)(!1),[C,S]=(0,s.useState)([]),[E,A]=(0,s.useState)([]),Z=(0,s.useRef)(null),P=(0,s.useRef)(null),T=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];b(!0);try{let a=t.length>0?"&tags=".concat(t.join(",")):"",r="/api/contacts?limit=20".concat(e?"&cursor=".concat(e):"").concat(a),s=await fetch(r);if(s.ok){let{contacts:t,nextCursor:a}=await s.json();e?o(e=>[...e,...t]):o(t),v(a),N(!!a)}}catch(e){console.error("Failed to fetch chats",e)}finally{b(!1)}},[]);(0,s.useEffect)(()=>{T(null,E)},[E,T]);let I=(0,s.useCallback)(e=>{!y&&(P.current&&P.current.disconnect(),P.current=new IntersectionObserver(e=>{e[0].isIntersecting&&k&&j&&T(j,E)}),e&&P.current.observe(e))},[y,k,j,T,E]);(0,s.useEffect)(()=>{(async()=>{let e=await fetch("/api/tags");e.ok&&S(await e.json())})();let e=e=>{Z.current&&!Z.current.contains(e.target)&&D(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.useEffect)(()=>{if(t){let e=e=>{o(t=>{let r=e.contactId;if(!r)return t;let s=r===a,l=!1,d=t.map(t=>t.id===r?(l=!0,{...t,lastMessage:e.text||("text"!==e.type?"Sent a ".concat(e.type):""),lastMessageAt:e.createdAt,unreadCount:s?0:(t.unreadCount||0)+("customer"===e.from?1:0)}):t);return l?d.sort((e,t)=>new Date(t.lastMessageAt||0).getTime()-new Date(e.lastMessageAt||0).getTime()):(Promise.resolve().then(()=>T(null,E)),t)})};return t.on("newMessage",e),()=>{t.off("newMessage",e)}}},[t,a,T,E]);let F=e=>{A(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},_=i.filter(e=>e.name.toLowerCase().includes(p.toLowerCase()));return(0,r.jsxs)("div",{className:"w-full md:w-80 border-r flex flex-col h-full bg-white dark:bg-[var(--sidebar-background)] border-gray-200 dark:border-[var(--card-border)]",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-[var(--card-border)]",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Chats"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 mt-3",children:[(0,r.jsx)("input",{type:"text",placeholder:"Search chats...",value:p,onChange:e=>f(e.target.value),className:"w-full p-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-[var(--incoming-bubble-bg)] border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"}),(0,r.jsxs)("div",{className:"relative",ref:Z,children:[(0,r.jsx)("button",{onClick:()=>D(e=>!e),className:"p-2 border rounded-md ".concat(E.length>0?"bg-blue-100 text-blue-600 dark:bg-blue-900/50":"bg-gray-50 dark:bg-[var(--incoming-bubble-bg)]"),children:(0,r.jsx)(u.Z,{name:"SlidersHorizontal",size:20})}),w&&(0,r.jsxs)("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-md shadow-lg z-20",children:[(0,r.jsx)("div",{className:"p-2 text-sm font-semibold border-b dark:border-gray-700",children:"Filter by Tag"}),(0,r.jsx)("div",{className:"p-2 max-h-48 overflow-y-auto",children:C.map(e=>(0,r.jsxs)("label",{className:"flex items-center space-x-2 p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:E.includes(e.id),onChange:()=>F(e.id),className:"h-4 w-4 text-blue-600 rounded"}),(0,r.jsx)("span",{children:e.name})]},e.id))}),E.length>0&&(0,r.jsx)("div",{className:"p-2 border-t dark:border-gray-700",children:(0,r.jsx)("button",{onClick:()=>A([]),className:"w-full text-center text-xs text-red-500 hover:underline",children:"Clear Filters"})})]})]})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:y&&0===i.length?(0,r.jsx)(c,{}):(0,r.jsxs)(m.E.ul,{variants:g,initial:"hidden",animate:"visible",children:[(0,r.jsx)(x.M,{children:_.map((e,t)=>{var s;return(0,r.jsx)(m.E.li,{ref:t===_.length-1?I:null,variants:h,exit:"exit",onClick:()=>l(e),className:"p-3 cursor-pointer border-b border-gray-200 dark:border-[var(--card-border)] hover:bg-gray-50 dark:hover:bg-[var(--input-background)] transition-colors ".concat(a===e.id?"bg-blue-50 dark:bg-[var(--incoming-bubble-bg)]":""),children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(n.Z,{initials:(e.name||"?").charAt(0).toUpperCase()}),(0,r.jsxs)("div",{className:"ml-3 flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("p",{className:"font-semibold text-sm truncate text-gray-800 dark:text-gray-100",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 flex-shrink-0 ml-2",children:e.lastMessageAt&&(0,d.Q)(new Date(e.lastMessageAt),{addSuffix:!0})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-start mt-1",children:[(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-300 truncate pr-2",children:e.lastMessage||"No messages yet"}),e.unreadCount&&e.unreadCount>0&&(0,r.jsx)("span",{className:"bg-green-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center flex-shrink-0",children:e.unreadCount})]}),(0,r.jsx)("div",{className:"flex items-center space-x-1 mt-2 overflow-hidden",children:null===(s=e.tags)||void 0===s?void 0:s.map(e=>(0,r.jsx)("div",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded",style:{backgroundColor:"".concat(e.color,"20"),color:e.color},children:e.name},e.id))})]})]})},e.id)})}),y&&i.length>0&&(0,r.jsx)("p",{className:"p-4 text-sm text-gray-500 dark:text-gray-300 text-center",children:"Loading more..."})]})})]})},b=a(3274),p=a(3907),f=a(4697),j=a(9827),v=a(8030);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let k=(0,v.Z)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);var N=a(8604);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let w=(0,v.Z)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);var D=a(994);let C=["\uD83D\uDE00","\uD83D\uDE03","\uD83D\uDE04","\uD83D\uDE01","\uD83D\uDE06","\uD83D\uDE05","\uD83D\uDE02","\uD83E\uDD23","\uD83D\uDE0A","\uD83D\uDE07","\uD83D\uDE42","\uD83D\uDE43","\uD83D\uDE09","\uD83D\uDE0C","\uD83D\uDE0D","\uD83E\uDD70","\uD83D\uDE18","\uD83D\uDE17","\uD83D\uDE19","\uD83D\uDE1A","\uD83D\uDE0B","\uD83D\uDE1B","\uD83D\uDE1D","\uD83D\uDE1C","\uD83E\uDD2A","\uD83E\uDD28","\uD83E\uDDD0","\uD83E\uDD13","\uD83D\uDE0E","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDE0F","\uD83D\uDE12","\uD83D\uDE1E","\uD83D\uDE14","\uD83D\uDE1F","\uD83D\uDE15","\uD83D\uDE41","☹️","\uD83D\uDE23","\uD83D\uDE16","\uD83D\uDE2B","\uD83D\uDE29","\uD83E\uDD7A","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE24","\uD83D\uDE20","\uD83D\uDE21","\uD83E\uDD2C","\uD83E\uDD2F","\uD83D\uDE33","\uD83E\uDD75","\uD83E\uDD76","\uD83D\uDE31","\uD83D\uDE28","\uD83D\uDE30","\uD83D\uDE25","\uD83D\uDE13","\uD83E\uDD17","\uD83E\uDD14","\uD83E\uDD2D","\uD83E\uDD2B","\uD83E\uDD25","\uD83D\uDE36","\uD83D\uDE10","\uD83D\uDE11","\uD83D\uDE2C","\uD83D\uDE44","\uD83D\uDE2F","\uD83D\uDE26","\uD83D\uDE27","\uD83D\uDE2E","\uD83D\uDE32","\uD83E\uDD71","\uD83D\uDE34","\uD83E\uDD24","\uD83D\uDE2A","\uD83D\uDE35","\uD83E\uDD10","\uD83E\uDD74","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD27","\uD83D\uDE37","\uD83E\uDD12","\uD83E\uDD15","\uD83E\uDD11","\uD83E\uDD20","❤️","\uD83E\uDDE1","\uD83D\uDC9B","\uD83D\uDC9A","\uD83D\uDC99","\uD83D\uDC9C","\uD83E\uDD0E","\uD83D\uDDA4","\uD83E\uDD0D","\uD83D\uDC94","\uD83D\uDC4D","\uD83D\uDC4E","\uD83D\uDC4C","✌️","\uD83E\uDD1E","\uD83D\uDE4F","\uD83D\uDE4C","\uD83D\uDC4F","\uD83E\uDD1D"];var S=e=>{let{onSelectEmoji:t,onClose:a}=e,l=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=e=>{l.current&&!l.current.contains(e.target)&&a()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[a]),(0,r.jsx)("div",{ref:l,className:"absolute bottom-full mb-2 bg-white p-3 rounded-2xl shadow-lg border w-80 h-60 overflow-y-auto",children:(0,r.jsx)("div",{className:"grid grid-cols-8 gap-1",children:C.map(e=>(0,r.jsx)("button",{onClick:()=>t(e),className:"text-2xl hover:bg-gray-200 rounded-lg p-1 transition-colors","aria-label":"Emoji ".concat(e),children:e},e))})})},E=e=>{let{newMessage:t,setNewMessage:a,sendMessage:l,replyingTo:d,onCancelReply:n,messages:i,smartReplies:o,isFetchingReplies:c,onCreateOrder:u}=e,[g,h]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[C,E]=(0,s.useState)(null),[A,Z]=(0,s.useState)(null),P=(0,s.useRef)(null),T=(0,s.useRef)(null),[I,F]=(0,s.useState)(!1),[_,M]=(0,s.useState)(""),[O,z]=(0,s.useState)(!1),[q,L]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=T.current;if(e){e.style.height="auto";let t=e.scrollHeight;e.style.height="".concat(t,"px")}},[t]);let U=e=>{l("string"==typeof e?e:t,C||void 0),a(""),E(null),Z(null)},R=async()=>{if(_.trim()&&i){z(!0),L("");try{let e=i.map(e=>"".concat("business"===e.from?"Business":"Customer",": ").concat(e.text||"[attachment]")).join("\n"),t=await fetch("/api/ai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:_,history:e})}),r=await t.json();if(!t.ok)throw Error(r.error||"VyaparAI is currently unavailable. Please try again.");r.functionCall&&"createOrder"===r.functionCall.name?u():a(r.text),F(!1),M("")}catch(e){console.error("VyaparAI error:",e),L(e.message||"VyaparAI is currently unavailable. Please try again."),setTimeout(()=>L(""),3e3)}finally{z(!1)}}};return(0,r.jsxs)("div",{className:"bg-gray-100 dark:bg-[var(--header-background)] p-2 sm:p-4 border-t border-gray-200 dark:border-[var(--card-border)] relative",children:[(0,r.jsx)(x.M,{children:(c||o.length>0)&&(0,r.jsxs)(m.E.div,{className:"mb-2 flex flex-wrap items-center gap-2",children:[c&&(0,r.jsx)(b.Z,{size:18,className:"animate-spin text-gray-400"}),o.map((e,t)=>(0,r.jsx)(m.E.button,{onClick:()=>U(e),className:"px-3 py-1.5 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-full text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 whitespace-nowrap",children:e},t))]})}),(0,r.jsx)(x.M,{children:I&&(0,r.jsxs)(m.E.div,{className:"mb-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(p.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-blue-500",size:20}),(0,r.jsx)("input",{type:"text",value:_,onChange:e=>M(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"Ask VyaparAI to draft a reply, create an order, etc...",className:"w-full bg-white dark:bg-gray-700 border-2 border-blue-400 rounded-full py-2 pl-10 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm",disabled:O}),O&&(0,r.jsx)(b.Z,{className:"absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-gray-500",size:20})]}),q&&(0,r.jsx)("p",{className:"text-xs text-red-500 text-center mt-1",children:q})]})}),d&&(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-700 p-2 rounded-t-lg text-sm relative border-l-2 border-blue-500 mb-2 shadow-sm",children:[(0,r.jsx)("button",{onClick:n,className:"absolute top-1 right-1 text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:(0,r.jsx)(f.Z,{size:16})}),(0,r.jsxs)("p",{className:"font-semibold text-blue-600 dark:text-blue-400",children:["Replying to ","business"===d.from?"yourself":"the customer"]}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300 truncate",children:d.text||"an attachment"})]}),A&&(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-700 p-2 rounded-t-lg relative mb-2 shadow-sm flex items-center space-x-3",children:[(0,r.jsx)("button",{onClick:()=>{E(null),Z(null),P.current&&(P.current.value="")},className:"absolute top-1 right-1 text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:(0,r.jsx)(f.Z,{size:16})}),"document"===A?(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,r.jsx)(j.Z,{className:"w-8 h-8 text-blue-500"}),(0,r.jsx)("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:null==C?void 0:C.name})]}):(0,r.jsx)("img",{src:A,alt:"preview",className:"w-16 h-16 object-cover rounded-md"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3 bg-white dark:bg-[var(--input-background)] px-3 py-2 sm:px-4 sm:py-3 rounded-full shadow-sm",children:[(0,r.jsx)("button",{onClick:()=>F(!I),className:"p-2 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 rounded-full transition-colors",title:"Ask VyaparAI",children:(0,r.jsx)(p.Z,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),(0,r.jsxs)("div",{className:"relative",children:[g&&(0,r.jsx)(S,{onSelectEmoji:e=>a(t+e),onClose:()=>h(!1)}),(0,r.jsx)("button",{onClick:()=>h(!g),className:"p-2 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 rounded-full transition-colors",children:(0,r.jsx)(k,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),(0,r.jsxs)("div",{className:"relative",children:[y&&(0,r.jsxs)("div",{className:"absolute bottom-full mb-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2",children:[(0,r.jsxs)("button",{onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:[(0,r.jsx)(N.Z,{className:"w-4 h-4 mr-2 text-purple-500"})," Image"]}),(0,r.jsxs)("button",{onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:[(0,r.jsx)(j.Z,{className:"w-4 h-4 mr-2 text-blue-500"})," Document"]})]}),(0,r.jsx)("button",{onClick:()=>v(!y),className:"p-2 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 rounded-full transition-colors",children:(0,r.jsx)(w,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),(0,r.jsx)("input",{type:"file",ref:P,onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(E(a),a.type.startsWith("image/")?Z(URL.createObjectURL(a)):Z("document")),v(!1)},className:"hidden",accept:"image/jpeg,image/png,application/pdf,.doc,.docx"}),(0,r.jsx)("textarea",{ref:T,rows:1,value:t,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),U())},placeholder:"Type a message...",className:"w-full bg-transparent focus:outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 resize-none max-h-32 overflow-y-auto",disabled:!!C}),(0,r.jsx)("button",{onClick:()=>U(),disabled:!(null==t?void 0:t.trim())&&!C,className:"p-2 sm:p-3 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 rounded-full transition-colors flex-shrink-0",children:(0,r.jsx)(D.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})})]})]})},A=a(883),Z=e=>{let{message:t,onClose:a,onConfirmDelete:s}=e;return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 animate-fade-in-up",style:{animationDuration:"0.2s"},children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-sm m-4",children:[(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Delete message?"}),(0,r.jsx)("div",{className:"my-4 p-3 bg-gray-100 rounded-md text-sm text-gray-700 truncate",children:t.text||t.fileName||"Attachment"})]}),(0,r.jsxs)("div",{className:"px-6 py-4 bg-gray-50 flex justify-end space-x-3 rounded-b-lg",children:[(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 text-sm font-semibold text-gray-700 bg-transparent rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,r.jsxs)("button",{onClick:()=>s(t.id),className:"px-4 py-2 text-sm font-semibold text-red-600 bg-transparent rounded-md hover:bg-red-50 transition-colors flex items-center",children:[(0,r.jsx)(A.Z,{size:16,className:"mr-1.5"})," Delete for Everyone"]})]})]})})};/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let P=(0,v.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),T=(0,v.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var I=e=>{let{images:t,startIndex:a,onClose:l}=e,[d,n]=(0,s.useState)(a),i=()=>{n(e=>0===e?t.length-1:e-1)},o=()=>{n(e=>e===t.length-1?0:e+1)};return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&l(),"ArrowLeft"===e.key&&i(),"ArrowRight"===e.key&&o()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t]),(0,r.jsxs)(m.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 backdrop-blur-sm",onClick:l,children:[(0,r.jsx)("button",{className:"absolute top-4 right-4 text-white/70 hover:text-white z-50",onClick:l,"aria-label":"Close gallery",children:(0,r.jsx)(f.Z,{size:32})}),t.length>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white z-50 bg-black/20 rounded-full p-2",onClick:e=>{e.stopPropagation(),i()},"aria-label":"Previous image",children:(0,r.jsx)(P,{size:32})}),(0,r.jsx)("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white z-50 bg-black/20 rounded-full p-2",onClick:e=>{e.stopPropagation(),o()},"aria-label":"Next image",children:(0,r.jsx)(T,{size:32})})]}),(0,r.jsx)(x.M,{mode:"wait",children:(0,r.jsx)(m.E.img,{src:t[d].url,alt:"Product image ".concat(d+1),initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"max-w-[90vw] max-h-[90vh] object-contain",onClick:e=>e.stopPropagation()},d)}),(0,r.jsxs)("div",{className:"absolute bottom-4 text-white/80 text-sm",children:[d+1," / ",t.length]})]})},F=a(5260);let _=e=>{let{line:t}=e;if(""===t.trim())return(0,r.jsx)("div",{className:"h-3"});let a=t.trim(),l=!1;a.startsWith("* ")&&(l=!0,a=a.substring(2));let d=a.split("**");if(3===d.length&&""===d[0]&&""===d[2].trim())return(0,r.jsx)("h4",{className:"font-semibold text-base mt-4 mb-2 text-gray-900 dark:text-gray-100",children:d[1]});let n=d.map((e,t)=>t%2==1?(0,r.jsx)("strong",{className:"font-semibold text-gray-800 dark:text-gray-200",children:e},t):(0,r.jsx)(s.Fragment,{children:e},t));return l?(0,r.jsxs)("div",{className:"flex items-start pl-2",children:[(0,r.jsx)("span",{className:"mr-2 mt-1 text-gray-500 dark:text-gray-400",children:"•"}),(0,r.jsx)("p",{className:"flex-1",children:n})]}):(0,r.jsx)("p",{children:n})};var M=e=>{let{isOpen:t,onClose:a,summary:s,isLoading:l}=e;return(0,r.jsxs)(F.Z,{isOpen:t,onClose:a,title:"Conversation Summary",children:[(0,r.jsx)("div",{className:"min-h-[200px] max-h-[60vh] overflow-y-auto pr-2",children:l?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-8",children:[(0,r.jsx)(b.Z,{className:"animate-spin text-blue-500",size:32}),(0,r.jsx)("p",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"Generating summary..."})]}):(0,r.jsx)("div",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:s.split("\n").map((e,t)=>(0,r.jsx)("div",{children:(0,r.jsx)(_,{line:e})},t))})}),(0,r.jsx)("div",{className:"flex justify-end mt-4 pt-4 border-t dark:border-gray-700",children:(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Close"})})]})},O=a(933),z=a(2468),q=a(2638),L=a(7164);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let U=(0,v.Z)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),R=(0,v.Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),B=(0,v.Z)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),Q=(0,v.Z)("BookText",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}],["path",{d:"M8 7h6",key:"1f0q6e"}],["path",{d:"M8 11h8",key:"vwpz6n"}]]),H=(0,v.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),J=(0,v.Z)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var V=a(9302),W=e=>{let{message:t,onImageClick:a}=e,{product:s}=t;if(!s||!s.images||0===s.images.length)return(0,r.jsxs)("div",{className:"w-64 p-3 rounded-lg border bg-gray-50",children:[(0,r.jsx)("p",{className:"font-semibold text-sm",children:(null==s?void 0:s.name)||"Product"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Image not available"}),(0,r.jsxs)("p",{className:"font-bold text-green-700 mt-1",children:["₹",null==s?void 0:s.price.toLocaleString("en-IN")]})]});let l=s.images,d=l.length,n=l.slice(0,4),i=d-4;return(0,r.jsxs)("div",{className:"w-64 rounded-lg overflow-hidden relative shadow-md cursor-pointer",children:[1===d?(0,r.jsx)("div",{className:"aspect-square w-full",onClick:()=>a(l,0),children:(0,r.jsx)("img",{src:l[0].url,alt:s.name,className:"w-full h-full object-cover"})}):2===d?(0,r.jsxs)("div",{className:"grid grid-cols-2 aspect-square w-full gap-1",children:[(0,r.jsx)("img",{src:l[0].url,alt:"".concat(s.name," 1"),className:"w-full h-full object-cover",onClick:()=>a(l,0)}),(0,r.jsx)("img",{src:l[1].url,alt:"".concat(s.name," 2"),className:"w-full h-full object-cover",onClick:()=>a(l,1)})]}):3===d?(0,r.jsxs)("div",{className:"grid grid-cols-2 grid-rows-2 aspect-square w-full gap-1",children:[(0,r.jsx)("img",{src:l[0].url,alt:"".concat(s.name," 1"),className:"w-full h-full object-cover col-span-1 row-span-2",onClick:()=>a(l,0)}),(0,r.jsx)("img",{src:l[1].url,alt:"".concat(s.name," 2"),className:"w-full h-full object-cover",onClick:()=>a(l,1)}),(0,r.jsx)("img",{src:l[2].url,alt:"".concat(s.name," 3"),className:"w-full h-full object-cover",onClick:()=>a(l,2)})]}):(0,r.jsx)("div",{className:"grid grid-cols-2 grid-rows-2 aspect-square w-full gap-1",children:n.map((e,t)=>(0,r.jsxs)("div",{className:"relative",onClick:()=>a(l,t),children:[(0,r.jsx)("img",{src:e.url,alt:"".concat(s.name," ").concat(t+1),className:"w-full h-full object-cover"}),3===t&&i>0&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:(0,r.jsxs)("span",{className:"text-white text-2xl font-bold",children:["+",i]})})]},e.id))}),(0,r.jsxs)("div",{className:"absolute inset-0 p-3 flex flex-col justify-end bg-gradient-to-t from-black/80 via-black/40 to-transparent pointer-events-none",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-bold text-sm text-white [text-shadow:0_1px_2px_rgba(0,0,0,0.5)]",children:s.name}),(0,r.jsxs)("p",{className:"font-semibold text-white mt-1 text-base [text-shadow:0_1px_2px_rgba(0,0,0,0.5)]",children:["₹",s.price.toLocaleString("en-IN")]})]}),(0,r.jsxs)("div",{className:"flex justify-end items-center text-xs text-white/80 mt-1 [text-shadow:0_1px_1px_rgba(0,0,0,0.5)]",children:[(0,r.jsx)("span",{children:(0,V.WU)(new Date(t.createdAt),"p")}),"business"===t.from&&(e=>{switch(e){case"pending":return(0,r.jsx)(O.Z,{size:16,className:"text-white/80 ml-1"});case"sent":return(0,r.jsx)(z.Z,{size:16,className:"text-white/80 ml-1"});case"delivered":return(0,r.jsx)(q.Z,{size:16,className:"text-white/80 ml-1"});case"read":return(0,r.jsx)(q.Z,{size:16,className:"text-[#53bdeb] ml-1"});case"failed":return(0,r.jsx)(f.Z,{size:16,className:"text-red-400 ml-1"});default:return null}})(t.status)]})]})]})};let Y=e=>{var t,a,r;return e?"image"===e.type&&e.mediaUrl?e.mediaUrl:"product"===e.type&&(null===(r=e.product)||void 0===r?void 0:null===(a=r.images)||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.url)?e.product.images[0].url:null:null};var G=e=>{let{chat:t,onPromoteCustomer:a,messages:l=[],onMessagesChange:d,initialMessage:n,initialNextCursor:i,onCreateOrder:o,onBack:c,onShowPanel:g}=e,[h,y]=(0,s.useState)(null),[p,j]=(0,s.useState)(null),[v,k]=(0,s.useState)(""),[N,w]=(0,s.useState)(null),D=(0,s.useRef)(null),C=(0,s.useRef)(null),S=(0,s.useRef)(null),A=(0,s.useRef)(0),[P,T]=(0,s.useState)(null),[F,_]=(0,s.useState)(!0),[G,K]=(0,s.useState)(!1),[X,$]=(0,s.useState)([]),[ee,et]=(0,s.useState)(!1),[ea,er]=(0,s.useState)(""),[es,el]=(0,s.useState)(!1),[ed,en]=(0,s.useState)(!1);(0,s.useEffect)(()=>{T(null!=i?i:null),_(!!i)},[i]);let ei=l.length>0?l[l.length-1].id:null,eo=()=>{var e;null===(e=D.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{eo()},[ei]),(0,s.useEffect)(()=>{n&&t&&k(n)},[n,null==t?void 0:t.id]);let ec=(0,s.useCallback)(async()=>{if(l&&0!==l.length){et(!0);try{let e=l.slice(-3).map(e=>"".concat("business"===e.from?"Business":"Customer",": ").concat(e.text||"[attachment]")).join("\n"),t=await fetch("/api/ai/smart-replies",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({history:e})});if(t.ok){let e=await t.json();$(e.replies||[])}}catch(e){console.error("Failed to fetch smart replies:",e),$([])}finally{et(!1)}}},[l]);(0,s.useEffect)(()=>{let e=l[l.length-1];e&&"customer"===e.from?ec():$([])},[l,ec]);let eu=async()=>{if(l&&0!==l.length){en(!0),el(!0),er("");try{let e=l.map(e=>"".concat("business"===e.from?"Business":"Customer",": ").concat(e.text||"[attachment]")).join("\n"),t=await fetch("/api/ai/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({history:e})});if(t.ok){let e=await t.json();er(e.text)}else throw Error("Failed to generate summary.")}catch(e){console.error("Summarization error:",e),er("Sorry, we couldn't generate a summary at this time.")}finally{el(!1)}}},em=(0,s.useCallback)(async()=>{if(!F||G||!P||!t)return;let e=C.current;e&&(A.current=e.scrollHeight),K(!0);try{let e=await fetch("/api/messages?contactId=".concat(t.id,"&limit=30&cursor=").concat(P));if(e.ok){let{messages:t,nextCursor:a}=await e.json();d(e=>[...t,...Array.isArray(e)?e:[]]),T(a),_(!!a)}}catch(e){console.error("Failed to load more messages:",e)}},[F,G,P,t,d]);(0,s.useLayoutEffect)(()=>{let e=C.current;e&&G&&(e.scrollTop=e.scrollHeight-A.current,K(!1))},[l.length,G]),(0,s.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting&&F&&!G&&em()},{threshold:1}),t=S.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[F,G,em]);let ex=e=>{if(!e)return;let t=document.getElementById("message-".concat(e));t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlight-message"),setTimeout(()=>{t.classList.remove("highlight-message")},1500))},eg=e=>{var t;return e?e.text?e.text:e.fileName?e.fileName:"image"===e.type?"\uD83D\uDCF7 Image":"document"===e.type?"\uD83D\uDCCE Document":(null===(t=e.product)||void 0===t?void 0:t.name)?"\uD83D\uDCE6 ".concat(e.product.name):"an attachment":null},eh=async(e,a)=>{if(!t||!e.trim()&&!a)return;let r=Date.now().toString();$([]);let s={id:r,from:"business",to:t.phone,text:a?a.name:e,createdAt:new Date().toISOString(),type:a?a.type.startsWith("image/")?"image":"document":"text",contactId:t.id,status:"pending",mediaUrl:a?URL.createObjectURL(a):void 0,fileName:a?a.name:void 0,replyToId:(null==h?void 0:h.id)||null,replyToText:eg(h),replyToMediaUrl:Y(h)};d(e=>Array.isArray(e)?[...e,s]:[s]),k(""),y(null);try{let s={contactId:t.id,text:e,replyingToId:(null==h?void 0:h.id)||null};if(a){let e=new FormData;e.append("file",a);let t=await fetch("/api/uploads/file",{method:"POST",body:e}),r=await t.json();if(!t.ok)throw Error("File upload failed");s.mediaUrl=r.url,s.fileName=a.name,s.type=a.type.startsWith("image/")?"image":"document"}let l=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!l.ok){let e=await l.json();throw Error(e.error||"Failed to send message")}let n=await l.json();d(e=>{let t=Array.isArray(e)?e:[];return t.some(e=>e.id===n.id)?t.filter(e=>e.id!==r):t.map(e=>e.id===r?n:e)})}catch(e){console.error("Failed to send message:",e),d(e=>(Array.isArray(e)?e:[]).map(e=>e.id===r?{...e,status:"failed"}:e))}},ey=async e=>{j(null),d(t=>(Array.isArray(t)?t:[]).filter(t=>t.id!==e));try{(await fetch("/api/messages/".concat(e),{method:"DELETE"})).ok||d(l)}catch(e){d(l)}},eb=e=>{switch(e){case"pending":return(0,r.jsx)(O.Z,{size:16,className:"text-gray-500 dark:text-gray-400 ml-1"});case"sent":return(0,r.jsx)(z.Z,{size:16,className:"text-gray-500 dark:text-gray-400 ml-1"});case"delivered":return(0,r.jsx)(q.Z,{size:16,className:"text-gray-500 dark:text-gray-400 ml-1"});case"read":return(0,r.jsx)(q.Z,{size:16,className:"text-blue-500 ml-1"});case"failed":return(0,r.jsx)(f.Z,{size:16,className:"text-red-500 ml-1"});default:return null}},ep=(e,t)=>{w({images:e,startIndex:t})},ef=e=>{switch(e.type){case"image":return(0,r.jsxs)("div",{children:[e.mediaUrl&&(0,r.jsx)("img",{src:e.mediaUrl,alt:e.text||"Sent media",className:"rounded-md max-w-xs cursor-pointer",onClick:()=>ep([{id:e.id,url:e.mediaUrl}],0)}),e.text&&(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap mt-1",children:e.text})]});case"document":return(0,r.jsxs)("a",{href:e.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center bg-black/5 dark:bg-black/20 p-2 rounded-lg hover:bg-black/10 dark:hover:bg-black/30",children:[(0,r.jsx)(u.Z,{name:"file",className:"w-8 h-8 text-gray-600 dark:text-gray-300 mr-2 flex-shrink-0"}),(0,r.jsx)("div",{className:"min-w-0",children:(0,r.jsx)("p",{className:"truncate font-medium",children:e.fileName||"Document"})}),(0,r.jsx)(L.Z,{className:"w-5 h-5 ml-2 text-gray-500 dark:text-gray-400 flex-shrink-0"})]});case"product":if(!e.product)return(0,r.jsxs)("p",{className:"px-3 py-2 text-sm italic",children:["Product: ",e.text||"Details not available."]});return(0,r.jsx)(W,{message:e,onImageClick:ep});default:return(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.text})}};return t?(0,r.jsxs)("div",{className:"w-full flex flex-col h-full",children:[(0,r.jsxs)("header",{className:"bg-white dark:bg-[var(--header-background)] px-2 py-3 sm:p-4 border-b border-gray-200 dark:border-[var(--card-border)] shadow-sm flex items-center justify-between z-10",children:[(0,r.jsxs)("div",{className:"flex items-center min-w-0",children:[(0,r.jsx)("button",{onClick:c,className:"mr-2 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 md:hidden","aria-label":"Back to chat list",children:(0,r.jsx)(u.Z,{name:"arrowLeft",size:20})}),(0,r.jsx)("div",{className:"w-9 h-9 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:(0,r.jsx)("span",{className:"font-bold text-gray-600 dark:text-gray-300",children:(t.name||"?").charAt(0).toUpperCase()})}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-800 dark:text-gray-100 truncate",children:t.name}),(0,r.jsx)("button",{onClick:a,title:t.isMasterCustomer?"Master Customer":"Promote to Master Customer",children:t.isMasterCustomer?(0,r.jsx)(R,{className:"text-yellow-500 fill-yellow-400",size:18}):(0,r.jsx)(B,{className:"text-gray-400 hover:text-blue-500",size:18})})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t.phone})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 md:space-x-2",children:[(0,r.jsx)("button",{onClick:eu,className:"p-2.5 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",title:"Summarize Conversation",children:(0,r.jsx)(Q,{size:20})}),(0,r.jsx)("button",{onClick:g,className:"p-2.5 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full md:hidden",title:"Contact Info",children:(0,r.jsx)(u.Z,{name:"info",size:20})}),(0,r.jsx)("button",{className:"p-2.5 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full hidden md:block",title:"Call Contact",children:(0,r.jsx)(H,{size:20})}),(0,r.jsx)("button",{className:"p-2.5 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full hidden md:block",title:"More Options",children:(0,r.jsx)(J,{size:20})})]})]}),(0,r.jsx)("main",{className:"flex-1 relative chat-background",children:(0,r.jsxs)("div",{ref:C,className:"absolute inset-0 overflow-y-auto p-2 sm:p-4",children:[(0,r.jsx)("div",{ref:S,className:"h-1"}),G&&(0,r.jsx)("div",{className:"text-center py-2",children:(0,r.jsx)(b.Z,{className:"animate-spin text-gray-500"})}),(0,r.jsx)(x.M,{children:(()=>{let e=Array.isArray(l)?l:[],t=null;return e.map((e,a)=>{let s=(0,V.WU)(new Date(e.createdAt),"yyyy-MM-dd"),l=s!==t;t=s;let d="business"===e.from,n="product"===e.type&&!!e.product;return(0,r.jsxs)(m.E.div,{children:[l&&(0,r.jsx)("div",{className:"text-center my-4",children:(0,r.jsx)("span",{className:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm shadow text-gray-600 dark:text-gray-300 text-xs font-semibold px-3 py-1 rounded-full",children:(0,V.WU)(new Date(e.createdAt),"MMMM d, yyyy")})}),(0,r.jsx)("div",{id:"message-".concat(e.id),className:"flex ".concat(d?"justify-end":"justify-start"," mt-1"),children:(0,r.jsxs)("div",{className:"flex items-end gap-2 group ".concat(d?"flex-row-reverse":"flex-row"),children:[(0,r.jsxs)("div",{className:"chat-bubble ".concat(d?"outgoing":"incoming"," \n                                 ").concat(n?"p-0 overflow-hidden bg-transparent shadow-none":""),children:[e.replyToId&&(0,r.jsx)("div",{onClick:()=>ex(e.replyToId),className:"text-xs bg-black/5 dark:bg-black/20 p-1.5 rounded-t-md mb-1 border-l-2 border-blue-500 cursor-pointer overflow-hidden",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[e.replyToMediaUrl&&(0,r.jsx)("img",{src:e.replyToMediaUrl,alt:"reply preview",className:"w-10 h-10 object-cover rounded-sm flex-shrink-0"}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsx)("p",{className:"truncate",children:e.replyToText})})]})}),ef(e),!n&&(0,r.jsxs)("div",{className:"flex justify-end items-center text-xs mt-1 text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{children:(0,V.WU)(new Date(e.createdAt),"p")}),d&&eb(e.status)]})]}),(0,r.jsxs)("div",{className:"flex opacity-0 group-hover:opacity-100 transition-opacity self-center",children:[(0,r.jsx)("button",{onClick:()=>y(e),className:"p-1 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full",title:"Reply",children:(0,r.jsx)(U,{size:16})}),d&&(0,r.jsx)("button",{onClick:()=>j(e),className:"p-1 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full",title:"Delete Message",children:(0,r.jsx)(u.Z,{name:"trash2",size:16})})]})]})})]},e.id)})})()}),(0,r.jsx)("div",{ref:D})]})}),(0,r.jsx)(E,{newMessage:v,setNewMessage:k,sendMessage:eh,messages:l,smartReplies:X,isFetchingReplies:ee,replyingTo:h?{text:eg(h),from:h.from}:null,onCancelReply:()=>y(null),onCreateOrder:o}),p&&(0,r.jsx)(Z,{message:p,onClose:()=>j(null),onConfirmDelete:ey}),N&&(0,r.jsx)(I,{images:N.images,startIndex:N.startIndex,onClose:()=>w(null)}),(0,r.jsx)(M,{isOpen:ed,onClose:()=>en(!1),summary:ea,isLoading:es})]}):(0,r.jsxs)("div",{className:"w-full chat-background flex flex-col items-center justify-center text-center h-full",children:[(0,r.jsx)(u.Z,{name:"messageCircle",size:48,className:"mx-auto text-gray-400 dark:text-gray-500"}),(0,r.jsx)("h2",{className:"text-2xl font-medium mt-4 text-gray-700 dark:text-gray-200",children:"Welcome to VyaparConnect"}),(0,r.jsx)("p",{className:"mt-2 text-gray-500 dark:text-gray-400",children:"Select a chat to start messaging."})]})},K=e=>{let{socket:t,contacts:a,setContacts:s,activeContact:l,onSelectContact:d,onPromoteCustomer:n,messages:i,setMessages:o,initialMessage:c,initialCursor:u,onCreateOrder:m,onShowPanel:x}=e;return(0,r.jsxs)("div",{className:"flex h-full bg-white overflow-hidden",children:[(0,r.jsx)("div",{className:"".concat(l?"hidden":"flex"," w-full md:flex md:w-auto flex-col"),children:(0,r.jsx)(y,{socket:t,activeContactId:(null==l?void 0:l.id)||null,onSelectChat:d})}),(0,r.jsx)("div",{className:"".concat(l?"flex":"hidden"," flex-1 md:flex flex-col min-w-0"),children:(0,r.jsx)(G,{chat:l,onPromoteCustomer:n,messages:i,onMessagesChange:o,initialMessage:c,initialNextCursor:u,onCreateOrder:m,onBack:()=>d(null),onShowPanel:x})})]})},X=a(5137),$=a(2513),ee=a(7524),et=a(2023);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let ea=(0,v.Z)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),er=(0,v.Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),es=e=>{let{workflow:t}=e,a={QUOTATION_FOCUSED:{label:"Q",color:"bg-green-100 text-green-800",title:"Quotation Specific"},ORDER_FOCUSED:{label:"O",color:"bg-orange-100 text-orange-800",title:"Order Specific"},HYBRID:{label:"H",color:"bg-blue-100 text-blue-800",title:"Hybrid"}}[t];return a?(0,r.jsx)("span",{title:a.title,className:"text-[10px] font-bold h-4 w-4 flex items-center justify-center rounded-full ml-2 flex-shrink-0 ".concat(a.color),children:a.label}):null};var el=e=>{let{products:t,onShareProduct:a,onEditProduct:s,onDeleteProduct:l}=e;return 0===t.length?(0,r.jsx)("p",{className:"p-4 text-center text-gray-500",children:"No products found for this workspace."}):(0,r.jsx)("div",{className:"p-2",children:t.map(e=>(0,r.jsxs)("div",{className:"p-2 mb-2 border dark:border-gray-700 rounded-lg flex items-center hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,r.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-16 h-16 object-cover rounded-md mr-3 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm truncate",children:e.name}),(0,r.jsx)(es,{workflow:e.workflow})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["₹",e.price.toLocaleString()]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 ml-2",children:[(0,r.jsx)("button",{onClick:()=>a(e),className:"p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-full",title:"Share Product",children:(0,r.jsx)(u.Z,{name:"share2",size:16})}),(0,r.jsx)("button",{onClick:()=>s(e),className:"p-2 text-gray-500 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-full",title:"Edit Product",children:(0,r.jsx)(u.Z,{name:"edit",size:16})}),(0,r.jsx)("button",{onClick:()=>l(e),className:"p-2 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-full",title:"Delete Product",children:(0,r.jsx)(u.Z,{name:"trash2",size:16})})]})]},e.id))})},ed=a(6649);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let en=(0,v.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var ei=e=>{let{children:t,color:a}=e;return(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat({green:"bg-green-100 text-green-800",gray:"bg-gray-200 text-gray-800",red:"bg-red-100 text-red-800",yellow:"bg-yellow-100 text-yellow-800"}[a]),children:t})};let eo=e=>{switch(e){case"PAID":case"BILLED":case"CONFIRMED":return"green";case"PARTIALLY_PAID":return"yellow";case"CANCELLED":return"red";default:return"gray"}},ec={hidden:{},visible:{transition:{staggerChildren:.07}}},eu={hidden:{y:15,opacity:0},visible:{y:0,opacity:1}};var em=e=>{let{contactId:t,onNewQuote:a,onBillQuote:l,onSendDraft:d,onSetFollowUp:n}=e,[i,o]=(0,s.useState)([]),[c,u]=(0,s.useState)(!0),[x,g]=(0,s.useState)(null),[h,y]=(0,s.useState)(null),p=async()=>{u(!0);try{let e=await fetch("/api/quotations?contactId=".concat(t));e.ok&&o(await e.json())}catch(e){console.error("Failed to fetch quotations:",e)}finally{u(!1)}};(0,s.useEffect)(()=>{t&&p()},[t]);let f=async()=>{if(x){y(x.id);try{if(!(await fetch("/api/quotations/".concat(x.id),{method:"DELETE"})).ok)throw Error("Failed to delete quotation");o(e=>e.filter(e=>e.id!==x.id)),g(null)}catch(e){console.error(e)}finally{y(null)}}},j=e=>{switch(e.status){case"DRAFT":return(0,r.jsxs)("button",{onClick:()=>d(e),className:"flex items-center text-blue-600 text-sm font-semibold hover:underline",children:[(0,r.jsx)(D.Z,{size:14,className:"mr-1"})," Review & Send"]});case"SENT":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>n(e),className:"flex items-center text-orange-600 text-sm font-semibold hover:underline",children:[(0,r.jsx)(O.Z,{size:14,className:"mr-1"})," Set Follow-up"]}),(0,r.jsxs)("button",{onClick:()=>l(e),className:"flex items-center text-green-600 text-sm font-semibold hover:underline ml-2",children:[(0,r.jsx)(ed.Z,{size:14,className:"mr-1"})," Finalize & Bill"]})]});case"CONFIRMED":return(0,r.jsxs)("button",{onClick:()=>l(e),className:"flex items-center text-green-600 text-sm font-semibold hover:underline",children:[(0,r.jsx)(D.Z,{size:14,className:"mr-1"})," Finalize & Bill"]});case"BILLED":case"PARTIALLY_PAID":return(0,r.jsxs)("button",{onClick:()=>l(e),className:"flex items-center text-blue-600 text-sm font-semibold hover:underline",children:[(0,r.jsx)(ed.Z,{size:14,className:"mr-1"})," Manage Payments"]});case"PAID":return(0,r.jsx)("span",{className:"text-sm font-semibold text-gray-400",children:"Paid in full"});case"CANCELLED":return(0,r.jsx)("span",{className:"text-sm font-semibold text-gray-400",children:"Cancelled"});default:return null}};return(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"font-bold text-lg",children:"Quotation History"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:p,disabled:c,className:"p-2 text-gray-500 hover:bg-gray-100 rounded-full disabled:opacity-50",children:(0,r.jsx)(en,{size:16,className:c?"animate-spin":""})}),(0,r.jsxs)("button",{onClick:a,className:"flex items-center bg-blue-600 text-white text-sm px-3 py-2 rounded-md hover:bg-blue-700",children:[(0,r.jsx)($.Z,{size:16,className:"mr-1"})," New"]})]})]}),c?(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:"Loading..."}):0===i.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:"No quotations found for this contact."}):(0,r.jsx)(m.E.ul,{className:"space-y-3",variants:ec,initial:"hidden",animate:"visible",children:i.map(e=>(0,r.jsxs)(m.E.li,{variants:eu,className:"p-3 border dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-semibold text-sm",children:["Quotation #",e.id.substring(0,6)]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:(0,V.WU)(new Date(e.createdAt),"PP")})]}),(0,r.jsx)(ei,{color:eo(e.status),children:e.status.replace("_"," ")})]}),(0,r.jsxs)("div",{className:"flex justify-between items-end mt-2",children:[(0,r.jsxs)("p",{className:"text-lg font-bold",children:["₹",e.total.toLocaleString("en-IN")]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[j(e),(0,r.jsx)("button",{onClick:()=>g(e),className:"p-1.5 text-gray-400 hover:bg-red-100 hover:text-red-600 rounded-full dark:hover:bg-red-900/30",title:"Delete Quotation",disabled:!!h,children:h===e.id?(0,r.jsx)(b.Z,{className:"animate-spin",size:16}):(0,r.jsx)(A.Z,{size:16})})]})]})]},e.id))}),x&&(0,r.jsxs)(F.Z,{isOpen:!!x,onClose:()=>g(null),title:"Confirm Deletion",children:[(0,r.jsxs)("p",{children:["Are you sure you want to delete Quotation ",(0,r.jsxs)("strong",{children:["#",x.id.substring(0,6)]}),"? This action cannot be undone."]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,r.jsx)("button",{onClick:()=>g(null),className:"px-4 py-2 border dark:border-gray-600 rounded-md",children:"Cancel"}),(0,r.jsx)("button",{onClick:f,className:"px-4 py-2 bg-red-600 text-white rounded-md",disabled:!!h,children:h?"Deleting...":"Delete"})]})]})]})};/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let ex=(0,v.Z)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),eg=(0,v.Z)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),eh=(0,v.Z)("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);var ey=e=>{let{quotation:t,onBack:a,onFinalized:l,socket:d}=e,[n,i]=(0,s.useState)(t),[o,c]=(0,s.useState)(n.discountPercentage||0),[u,m]=(0,s.useState)(n.taxRate||0),[x,g]=(0,s.useState)(n.deliveryCharges||0),[h,y]=(0,s.useState)(n.total),[p,f]=(0,s.useState)(n.payments||[]),[j,v]=(0,s.useState)(!1),[k,N]=(0,s.useState)(null),[w,C]=(0,s.useState)(""),[S,E]=(0,s.useState)(!1),[A,Z]=(0,s.useState)({amount:"",method:"Cash",notes:""}),P=p.reduce((e,t)=>e+t.amount,0),T=h-P,I="DRAFT"!==n.status&&"SENT"!==n.status&&"CONFIRMED"!==n.status;(0,s.useEffect)(()=>{let e=n.subtotal,t=e*o/100,a=e-t,r=a*u/100;y(a+r+x)},[o,u,x,n.subtotal]);let _=async()=>{try{let e=await fetch("/api/quotations/".concat(n.id,"/payments"));if(e.ok){let t=await e.json();f(t)}}catch(e){console.error(e)}};(0,s.useEffect)(()=>{if(_(),d){let e=e=>{e.id===n.id&&(i(e),f(e.payments||[]))};return d.on("quotation_update",e),()=>{d.off("quotation_update",e)}}},[n.id,d]);let M=async()=>{v(!0),C("");try{let e=await fetch("/api/quotations/".concat(n.id,"/finalize"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({discountPercentage:o,taxRate:u,deliveryCharges:x,total:h})});if(!e.ok)throw Error("Failed to save bill.");let t=await e.json();i(t)}catch(e){C(e.message)}finally{v(!1)}},O=async(e,t)=>{N(e),C("");try{let a={action:e};void 0!==t&&t>0&&(a.amount=t);let r=await fetch("/api/quotations/".concat(n.id,"/send-bill-action"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){let e=await r.json();throw Error(e.error||"Action failed.")}}catch(e){C(e.message)}finally{N(null)}},z=async e=>{e.preventDefault(),v(!0),C("");try{let e=await fetch("/api/quotations/".concat(n.id,"/payments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...A,amount:parseFloat(A.amount)})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to add payment.");i(e=>e?{...e,status:t.status,payments:t.payments}:t),f(t.payments||[]),E(!1),Z({amount:"",method:"Cash",notes:""})}catch(e){C(e.message)}finally{v(!1)}};return(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[w&&(0,r.jsx)("p",{className:"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-300 p-2 rounded-md text-sm mb-2",children:w}),(0,r.jsxs)("div",{className:"p-3 border dark:border-gray-700 rounded-lg space-y-3",children:[(0,r.jsx)("h4",{className:"font-semibold text-sm text-gray-800 dark:text-gray-100",children:"Final Bill Calculation"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Discount (%)"}),(0,r.jsx)("input",{type:"number",value:o,onChange:e=>c(parseFloat(e.target.value)||0),className:"w-full border rounded-md p-1.5 text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",disabled:I})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Tax / GST (%)"}),(0,r.jsx)("input",{type:"number",value:u,onChange:e=>m(parseFloat(e.target.value)||0),className:"w-full border rounded-md p-1.5 text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",disabled:I})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Delivery Charges (₹)"}),(0,r.jsx)("input",{type:"number",value:x,onChange:e=>g(parseFloat(e.target.value)||0),className:"w-full border rounded-md p-1.5 text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",disabled:I})]}),(0,r.jsxs)("div",{className:"text-right font-bold text-lg text-gray-800 dark:text-gray-100",children:["Total: ₹",h.toFixed(2)]}),!I&&(0,r.jsx)("button",{onClick:M,disabled:j,className:"w-full bg-blue-600 text-white py-2 rounded-md text-sm font-semibold disabled:opacity-50",children:j?"Saving...":"Save & Lock Bill"})]}),I&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"p-3 border dark:border-gray-700 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-semibold text-sm mb-2 text-gray-800 dark:text-gray-100",children:"Payment Status"}),(0,r.jsxs)("div",{className:"text-sm space-y-1 text-gray-700 dark:text-gray-300",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Total Bill:"})," ",(0,r.jsxs)("span",{className:"font-bold text-gray-800 dark:text-gray-100",children:["₹",h.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Total Paid:"})," ",(0,r.jsxs)("span",{className:"font-bold text-green-600 dark:text-green-400",children:["₹",P.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Amount Due:"})," ",(0,r.jsxs)("span",{className:"font-bold text-red-600 dark:text-red-400",children:["₹",T.toFixed(2)]})]})]}),(0,r.jsx)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 max-h-24 overflow-y-auto",children:p.map(e=>(0,r.jsxs)("div",{className:"flex justify-between items-center border-t dark:border-gray-600 py-1",children:[(0,r.jsxs)("span",{children:[e.method," (",(0,V.WU)(new Date(e.createdAt),"PP"),")"]}),(0,r.jsxs)("span",{children:["₹",e.amount.toFixed(2)]})]},e.id))}),(0,r.jsxs)("button",{onClick:()=>E(!0),className:"w-full mt-3 flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 py-2 rounded-md",children:[(0,r.jsx)($.Z,{size:16,className:"mr-1"})," Record Manual Payment"]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-semibold text-sm pt-2 text-gray-800 dark:text-gray-100",children:"Payment Actions"}),(0,r.jsx)("button",{onClick:()=>O("send_final_bill"),disabled:!!k,className:"w-full flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 p-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"send_final_bill"===k?(0,r.jsx)(b.Z,{className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D.Z,{size:16,className:"mr-2"})," Send Bill Image"]})}),(0,r.jsx)("button",{onClick:()=>O("send_razorpay",T),disabled:!!k||T<=0,className:"w-full flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 p-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"send_razorpay"===k?(0,r.jsx)(b.Z,{className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ex,{size:16,className:"mr-2"})," Send Payment Link"]})}),(0,r.jsx)("button",{onClick:()=>O("send_bank_details",T),disabled:!!k||T<=0,className:"w-full flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 p-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"send_bank_details"===k?(0,r.jsx)(b.Z,{className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eg,{size:16,className:"mr-2"})," Send Bank Details"]})}),(0,r.jsx)("button",{onClick:()=>O("send_qr_code",T),disabled:!!k||T<=0,className:"w-full flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 p-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"send_qr_code"===k?(0,r.jsx)(b.Z,{className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eh,{size:16,className:"mr-2"})," Send UPI QR Code"]})})]})]}),(0,r.jsx)(F.Z,{isOpen:S,onClose:()=>E(!1),title:"Record Manual Payment",children:(0,r.jsxs)("form",{onSubmit:z,className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Amount"}),(0,r.jsx)("input",{type:"number",placeholder:"Amount paid",value:A.amount,onChange:e=>Z(t=>({...t,amount:e.target.value})),required:!0,className:"w-full border rounded-md p-2 text-sm mt-1 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Method"}),(0,r.jsxs)("select",{value:A.method,onChange:e=>Z(t=>({...t,method:e.target.value})),className:"w-full border rounded-md p-2 text-sm mt-1 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",children:[(0,r.jsx)("option",{children:"Cash"})," ",(0,r.jsx)("option",{children:"Bank Transfer"})," ",(0,r.jsx)("option",{children:"UPI"})," ",(0,r.jsx)("option",{children:"Other"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notes (Optional)"}),(0,r.jsx)("input",{type:"text",placeholder:"e.g., Transaction ID",value:A.notes,onChange:e=>Z(t=>({...t,notes:e.target.value})),className:"w-full border rounded-md p-2 text-sm mt-1 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>E(!1),className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:j,className:"px-4 py-2 text-sm bg-green-600 text-white rounded-md disabled:opacity-50",children:j?"Adding...":"Add Payment"})]})]})})]})};function eb(e,t){switch(t.type){case"UPDATE_FIELD":return{...e,[t.field]:t.payload};case"UPDATE_ITEM":{let a=[...e.items];return a[t.index][t.field]=t.payload,"productId"===t.field&&t.product&&(a[t.index].price=t.product.price,a[t.index].name=t.product.name),{...e,items:a}}case"ADD_ITEM":return{...e,items:[...e.items,{productId:"",quantity:1,price:0}]};case"REMOVE_ITEM":return{...e,items:e.items.filter((e,a)=>a!==t.index)};default:return e}}var ep=e=>{let{contact:t,onCancel:a,onQuotationCreated:l}=e,d={customerName:t.name,contactNumber:t.phone,billingAddress:t.lastBillingAddress||t.lastAddress||"",shippingAddress:t.lastShippingAddress||t.shippingAddress||"",items:[{productId:"",quantity:1,price:0}]},[n,i]=(0,s.useReducer)(eb,d),[o,c]=(0,s.useState)([]),[u,m]=(0,s.useState)(!1),[x,g]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{let e=await fetch("/api/products");e.ok&&c(await e.json())})()},[]);let h=(e,t,a)=>{let r;"productId"===t&&(r=o.find(e=>e.id===a)),i({type:"UPDATE_ITEM",index:e,field:t,payload:a,product:r})},y=e=>i({type:"REMOVE_ITEM",index:e}),b=n.items.reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0),p=async e=>{e.preventDefault(),m(!0),g("");try{let{customerName:e,contactNumber:a,billingAddress:r,shippingAddress:s,items:d}=n,i=await fetch("/api/quotations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactId:t.id,customerName:e,contactNumber:a,billingAddress:r,shippingAddress:s,items:d.map(e=>{let{name:t,...a}=e;return a}).filter(e=>e.productId),subtotal:b,total:b,status:"DRAFT"})});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to create quotation")}let o=await i.json();l(o)}catch(e){g(e.message)}finally{m(!1)}};return(0,r.jsxs)("form",{onSubmit:p,className:"p-4",children:[x&&(0,r.jsx)("p",{className:"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-300 p-2 rounded-md text-sm mb-4",children:x}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsx)("input",{type:"text",value:n.customerName,onChange:e=>i({type:"UPDATE_FIELD",field:"customerName",payload:e.target.value}),placeholder:"Customer Name",className:"w-full border rounded-md p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",required:!0}),(0,r.jsx)("input",{type:"text",value:n.contactNumber,onChange:e=>i({type:"UPDATE_FIELD",field:"contactNumber",payload:e.target.value}),placeholder:"Contact Number",className:"w-full border rounded-md p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",required:!0}),(0,r.jsx)("textarea",{value:n.billingAddress,onChange:e=>i({type:"UPDATE_FIELD",field:"billingAddress",payload:e.target.value}),placeholder:"Billing Address",className:"w-full border rounded-md p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",rows:2,required:!0}),(0,r.jsx)("textarea",{value:n.shippingAddress,onChange:e=>i({type:"UPDATE_FIELD",field:"shippingAddress",payload:e.target.value}),placeholder:"Shipping Address",className:"w-full border rounded-md p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",rows:2,required:!0})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h4",{className:"font-semibold mb-2 text-gray-800 dark:text-gray-100",children:"Products"}),(0,r.jsx)("div",{className:"space-y-3",children:n.items.map((e,t)=>{var a,s;return(0,r.jsxs)("div",{className:"p-3 border rounded-lg dark:border-gray-700 bg-gray-50/50 dark:bg-gray-700/30",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("select",{value:null!==(s=e.productId)&&void 0!==s?s:"",onChange:e=>h(t,"productId",e.target.value),className:"w-full border rounded-md p-2 text-sm bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100 font-medium",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select Product"}),o.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsx)("button",{type:"button",onClick:()=>y(t),className:"ml-2 p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full flex-shrink-0",children:(0,r.jsx)(A.Z,{size:16})})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-[80px]",children:[(0,r.jsx)("label",{htmlFor:"quantity-".concat(t),className:"text-xs text-gray-500",children:"Quantity"}),(0,r.jsx)("input",{id:"quantity-".concat(t),type:"number",value:e.quantity,onChange:e=>h(t,"quantity",parseInt(e.target.value,10)),min:"1",placeholder:"Quantity",className:"w-full border rounded-md p-2 text-sm bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100 mt-1"})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-[100px]",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 text-right block",children:"Unit Price"}),(0,r.jsx)("div",{className:"flex items-center justify-end px-2 rounded-md bg-gray-200/70 dark:bg-gray-800/70 h-10 mt-1",children:(0,r.jsxs)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["@ ₹",null===(a=e.price)||void 0===a?void 0:a.toFixed(2)]})})]})]})]},t)})}),(0,r.jsxs)("button",{type:"button",onClick:()=>i({type:"ADD_ITEM"}),className:"flex items-center text-sm text-blue-600 dark:text-blue-400 mt-3",children:[(0,r.jsx)($.Z,{size:16,className:"mr-1"})," Add Item"]})]}),(0,r.jsxs)("div",{className:"mt-4 text-right font-bold text-gray-800 dark:text-gray-100",children:["Subtotal: ₹",b.toFixed(2)]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:u,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md disabled:opacity-50 flex items-center justify-center",children:u?"Generating...":"Generate & Preview"})]})]})};/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let ef=(0,v.Z)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);var ej=a(2781),ev=e=>{let{quotation:t,onCancel:a,onSuccess:l}=e,[d,n]=(0,s.useState)((0,V.WU)((0,ej.E)(new Date,3),"yyyy-MM-dd'T'HH:mm")),i="Follow up with ".concat(t.customerName," about Quotation #").concat(t.id.substring(0,6),"."),o="Hi ".concat(t.customerName,", this is a friendly follow-up regarding the quotation for ₹").concat(t.total.toLocaleString("en-IN")," we sent you recently. Please let us know if you have any questions or are ready to proceed. Thank you!"),[c,u]=(0,s.useState)(i),[m,x]=(0,s.useState)(o),[g,h]=(0,s.useState)(!1),[y,p]=(0,s.useState)(""),f=async e=>{e.preventDefault(),h(!0),p("");try{let e=await fetch("/api/contacts/".concat(t.contactId,"/reminders"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({remindAt:new Date(d).toISOString(),ownerMessage:c,customerMessage:m,quotationId:t.id})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to set reminder.")}l()}catch(e){p(e.message)}finally{h(!1)}};return(0,r.jsxs)("form",{onSubmit:f,className:"p-4 space-y-4",children:[y&&(0,r.jsx)("p",{className:"text-red-600 bg-red-50 p-2 rounded-md text-sm",children:y}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Remind on"}),(0,r.jsx)("input",{type:"datetime-local",value:d,onChange:e=>n(e.target.value),className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Internal Note (for you)"}),(0,r.jsx)("textarea",{value:c,onChange:e=>u(e.target.value),rows:2,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Automated Message (to customer)"}),(0,r.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),rows:4,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank to not send an automated message."})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md",children:"Cancel"}),(0,r.jsxs)("button",{type:"submit",disabled:g,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md disabled:opacity-50 flex items-center",children:[g?(0,r.jsx)(b.Z,{className:"animate-spin mr-2"}):(0,r.jsx)(ef,{className:"mr-2",size:16}),"Set Reminder"]})]})]})};function ek(e,t){switch(t.type){case"UPDATE_FIELD":return{...e,[t.field]:t.payload};case"ADD_ITEM":return{...e,items:[...e.items,{id:Date.now(),productName:"",quantity:"1",price:"0"}]};case"REMOVE_ITEM":return{...e,items:e.items.filter(e=>e.id!==t.id)};case"UPDATE_ITEM":return{...e,items:e.items.map(e=>e.id===t.id?{...e,[t.field]:t.payload}:e)};default:return e}}var eN=e=>{let{contact:t,onCancel:a,onOrderCreated:l,suggestedAddress:d}=e,n={customerName:t.name,billingAddress:t.lastBillingAddress||t.lastAddress||"",shippingAddress:t.lastShippingAddress||t.shippingAddress||"",items:[{id:Date.now(),productName:"",quantity:"1",price:"0"}],discountPercentage:"0",deliveryCharges:"0"},[i,o]=(0,s.useReducer)(ek,n),[c,u]=(0,s.useState)([]),[m,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{let e=await fetch("/api/products");e.ok&&u(await e.json())})()},[]),(0,s.useEffect)(()=>{d&&o({type:"UPDATE_FIELD",field:"shippingAddress",payload:d})},[d]);let y=(e,t)=>{let a=c.find(e=>e.name.toLowerCase()===t.toLowerCase());a?(o({type:"UPDATE_ITEM",id:e,field:"productName",payload:a.name}),o({type:"UPDATE_ITEM",id:e,field:"productId",payload:a.id}),o({type:"UPDATE_ITEM",id:e,field:"price",payload:a.price.toString()})):(o({type:"UPDATE_ITEM",id:e,field:"productName",payload:t}),o({type:"UPDATE_ITEM",id:e,field:"productId",payload:void 0}))},p=i.items.reduce((e,t)=>e+(isNaN(parseFloat(t.quantity))?0:parseFloat(t.quantity))*(parseFloat(t.price)||0),0),f=p*(parseFloat(i.discountPercentage)||0)/100,j=p-f+(parseFloat(i.deliveryCharges)||0),v=async e=>{e.preventDefault(),x(!0),h("");let a=i.items.filter(e=>e.productName.trim()&&parseFloat(e.price)>=0).map(e=>({...e,price:parseFloat(e.price)}));if(0===a.length){h("Please add at least one valid item."),x(!1);return}try{let e=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactId:t.id,customerName:i.customerName,contactNumber:t.phone,billingAddress:i.billingAddress,shippingAddress:i.shippingAddress,items:a,subtotal:p,total:j,discountPercentage:parseFloat(i.discountPercentage)||0,deliveryCharges:parseFloat(i.deliveryCharges)||0})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to create order")}let r=await e.json();l(r)}catch(e){h(e.message)}finally{x(!1)}};return(0,r.jsxs)("form",{onSubmit:v,className:"p-4",children:[g&&(0,r.jsx)("p",{className:"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-300 p-2 rounded-md text-sm mb-4",children:g}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsx)("input",{type:"text",value:i.customerName,onChange:e=>o({type:"UPDATE_FIELD",field:"customerName",payload:e.target.value}),placeholder:"Customer Name",className:"w-full border rounded-md p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",required:!0}),(0,r.jsx)("textarea",{value:i.billingAddress,onChange:e=>o({type:"UPDATE_FIELD",field:"billingAddress",payload:e.target.value}),placeholder:"Billing Address",className:"w-full border rounded-md p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",rows:2,required:!0}),(0,r.jsx)("textarea",{value:i.shippingAddress,onChange:e=>o({type:"UPDATE_FIELD",field:"shippingAddress",payload:e.target.value}),placeholder:"Shipping Address",className:"w-full border rounded-md p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",rows:2,required:!0})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h4",{className:"font-semibold mb-2 text-gray-800 dark:text-gray-100",children:"Items"}),(0,r.jsx)("div",{className:"space-y-3",children:i.items.map((e,t)=>(0,r.jsxs)("div",{className:"p-3 border rounded-lg dark:border-gray-700 bg-gray-50/50 dark:bg-gray-700/30",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsx)("input",{list:"product-list",type:"text",value:e.productName,onChange:t=>y(e.id,t.target.value),placeholder:"Item #".concat(t+1," Name"),className:"w-full border rounded-md p-2 text-sm bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100 font-medium",required:!0}),(0,r.jsx)("button",{type:"button",onClick:()=>o({type:"REMOVE_ITEM",id:e.id}),className:"ml-2 p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full flex-shrink-0",children:(0,r.jsx)(A.Z,{size:16})})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-[80px]",children:[(0,r.jsx)("label",{htmlFor:"quantity-".concat(e.id),className:"text-xs text-gray-500",children:"Quantity"}),(0,r.jsx)("input",{id:"quantity-".concat(e.id),type:"text",value:e.quantity,onChange:t=>o({type:"UPDATE_ITEM",id:e.id,field:"quantity",payload:t.target.value}),placeholder:"e.g., 1 or 250g",className:"w-full border rounded-md p-2 text-sm bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100 mt-1",required:!0})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-[100px]",children:[(0,r.jsx)("label",{htmlFor:"price-".concat(e.id),className:"text-xs text-gray-500",children:"Price (₹)"}),(0,r.jsx)("input",{id:"price-".concat(e.id),type:"number",value:e.price,onChange:t=>o({type:"UPDATE_ITEM",id:e.id,field:"price",payload:t.target.value}),placeholder:"Unit Price",step:"0.01",className:"w-full border rounded-md p-2 text-sm bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100 mt-1",required:!0})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-[100px]",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 text-right block",children:"Subtotal"}),(0,r.jsx)("div",{className:"flex items-center justify-end px-2 rounded-md bg-gray-200/70 dark:bg-gray-800/70 h-10 mt-1",children:(0,r.jsxs)("span",{className:"text-sm font-semibold text-right dark:text-gray-200",children:["₹",((isNaN(parseFloat(e.quantity))?0:parseFloat(e.quantity))*(parseFloat(e.price)||0)).toFixed(2)]})})]})]})]},e.id))}),(0,r.jsx)("datalist",{id:"product-list",children:c.map(e=>(0,r.jsx)("option",{value:e.name},e.id))}),(0,r.jsxs)("button",{type:"button",onClick:()=>o({type:"ADD_ITEM"}),className:"flex items-center text-sm text-blue-600 dark:text-blue-400 mt-3",children:[(0,r.jsx)($.Z,{size:16,className:"mr-1"})," Add Item"]})]}),(0,r.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs",children:"Discount (%)"}),(0,r.jsx)("input",{type:"number",value:i.discountPercentage,onChange:e=>o({type:"UPDATE_FIELD",field:"discountPercentage",payload:e.target.value}),className:"w-full border rounded-md p-2 text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs",children:"Delivery (₹)"}),(0,r.jsx)("input",{type:"number",value:i.deliveryCharges,onChange:e=>o({type:"UPDATE_FIELD",field:"deliveryCharges",payload:e.target.value}),className:"w-full border rounded-md p-2 text-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]})]}),(0,r.jsxs)("div",{className:"text-right font-bold text-lg text-gray-800 dark:text-gray-100",children:["Total: ₹",j.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md disabled:opacity-50 flex items-center justify-center",children:m?(0,r.jsx)(b.Z,{className:"animate-spin"}):"Create & View Bill"})]})]})},ew=a(4727);let eD={hidden:{},visible:{transition:{staggerChildren:.07}}},eC={hidden:{y:15,opacity:0},visible:{y:0,opacity:1}};var eS=e=>{let{contactId:t,onNewOrder:a,onManagePayments:l}=e,[d,n]=(0,s.useState)([]),[i,o]=(0,s.useState)(!0),[c,u]=(0,s.useState)(null),[x,g]=(0,s.useState)(null),h=async()=>{o(!0);try{let e=await fetch("/api/orders?contactId=".concat(t));e.ok&&n(await e.json())}catch(e){console.error("Failed to fetch orders:",e)}finally{o(!1)}};(0,s.useEffect)(()=>{t&&h()},[t]);let y=async()=>{if(c){g(c.id);try{if(!(await fetch("/api/orders/".concat(c.id),{method:"DELETE"})).ok)throw Error("Failed to delete order.");n(e=>e.filter(e=>e.id!==c.id)),u(null)}catch(e){console.error(e)}finally{g(null)}}};return(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"font-bold text-lg",children:"Order History"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:h,disabled:i,className:"p-2 text-gray-500 hover:bg-gray-100 rounded-full disabled:opacity-50",children:(0,r.jsx)(en,{size:16,className:i?"animate-spin":""})}),(0,r.jsxs)("button",{onClick:a,className:"flex items-center bg-blue-600 text-white text-sm px-3 py-2 rounded-md hover:bg-blue-700",children:[(0,r.jsx)($.Z,{size:16,className:"mr-1"})," New"]})]})]}),i?(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:"Loading..."}):0===d.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:"No orders found for this contact."}):(0,r.jsx)(m.E.ul,{className:"space-y-3",variants:eD,initial:"hidden",animate:"visible",children:d.map(e=>(0,r.jsxs)(m.E.li,{variants:eC,className:"p-3 border dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-semibold text-sm",children:["Order #",e.id.substring(0,6)]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:(0,V.WU)(new Date(e.createdAt),"PP")})]}),(0,r.jsx)(ew.Z,{status:e.status})]}),(0,r.jsxs)("div",{className:"flex justify-between items-end mt-2",children:[(0,r.jsxs)("p",{className:"text-lg font-bold",children:["₹",e.total.toLocaleString("en-IN")]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("button",{onClick:()=>l(e),className:"flex items-center text-blue-600 text-sm font-semibold hover:underline",children:[(0,r.jsx)(ee.Z,{size:14,className:"mr-1"})," Manage Payments"]}),(0,r.jsx)("button",{onClick:()=>u(e),className:"p-1.5 text-gray-400 hover:bg-red-100 hover:text-red-600 rounded-full dark:hover:bg-red-900/30",title:"Delete Order",disabled:!!x,children:x===e.id?(0,r.jsx)(b.Z,{className:"animate-spin",size:16}):(0,r.jsx)(A.Z,{size:16})})]})]})]},e.id))}),c&&(0,r.jsxs)(F.Z,{isOpen:!!c,onClose:()=>u(null),title:"Confirm Deletion",children:[(0,r.jsxs)("p",{children:["Are you sure you want to delete Order ",(0,r.jsxs)("strong",{children:["#",c.id.substring(0,6)]}),"? This action cannot be undone."]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,r.jsx)("button",{onClick:()=>u(null),className:"px-4 py-2 border dark:border-gray-600 rounded-md",children:"Cancel"}),(0,r.jsx)("button",{onClick:y,className:"px-4 py-2 bg-red-600 text-white rounded-md",disabled:!!x,children:x?"Deleting...":"Delete"})]})]})]})},eE=a(6780);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let eA=(0,v.Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var eZ=e=>{let{order:t,onDone:a}=e,[l,d]=(0,s.useState)(!1),[n,i]=(0,s.useState)(null),[o,c]=(0,s.useState)(!1),u=async()=>{d(!0),i(null);try{let e=await fetch("/api/orders/".concat(t.id,"/send-bill"),{method:"POST"}),a=await e.json();if(!e.ok)throw Error(a.error||"Failed to send bill.");c(!0)}catch(e){i(e.message)}finally{d(!1)}},m=t.items.reduce((e,t)=>e+t.price*Number(t.quantity),0),x=m*(t.discountPercentage||0)/100;return(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-bold text-lg mb-4 text-center",children:"Order Created!"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4 text-xs",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-500 dark:text-gray-400",children:"Billing To"}),(0,r.jsx)("p",{className:"whitespace-pre-wrap text-gray-700 dark:text-gray-300",children:t.billingAddress})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-500 dark:text-gray-400",children:"Shipping To"}),(0,r.jsx)("p",{className:"whitespace-pre-wrap text-gray-700 dark:text-gray-300",children:t.shippingAddress})]})]}),(0,r.jsxs)("div",{className:"p-4 border dark:border-gray-700 rounded-lg bg-gray-50/50 dark:bg-gray-900/50 space-y-3 text-sm",children:[(0,r.jsxs)("table",{className:"w-full text-left",children:[(0,r.jsx)("thead",{className:"text-xs text-gray-500",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"pb-1 font-medium",children:"Item"}),(0,r.jsx)("th",{className:"pb-1 font-medium text-right",children:"Price"})]})}),(0,r.jsx)("tbody",{children:t.items.map(e=>(0,r.jsxs)("tr",{className:"border-t dark:border-gray-600",children:[(0,r.jsxs)("td",{className:"py-2",children:[e.productName," ",(0,r.jsxs)("span",{className:"text-gray-500",children:["x ",e.quantity]})]}),(0,r.jsxs)("td",{className:"py-2 text-right",children:["₹",e.price.toFixed(2)]})]},e.id))})]}),(0,r.jsxs)("div",{className:"space-y-1 pt-2 border-t dark:border-gray-600",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Subtotal"}),(0,r.jsxs)("span",{children:["₹",m.toFixed(2)]})]}),t.discountPercentage&&t.discountPercentage>0&&(0,r.jsxs)("div",{className:"flex justify-between text-red-600 dark:text-red-400",children:[(0,r.jsxs)("span",{children:["Discount (",t.discountPercentage,"%)"]}),(0,r.jsxs)("span",{children:["- ₹",x.toFixed(2)]})]}),t.deliveryCharges&&t.deliveryCharges>0&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Delivery Charges"}),(0,r.jsxs)("span",{children:["+ ₹",t.deliveryCharges.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between font-bold text-base pt-1 border-t dark:border-gray-600 mt-1",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsxs)("span",{children:["₹",t.total.toFixed(2)]})]})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[n&&(0,r.jsxs)("div",{className:"p-2 mb-2 bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-300 rounded-md text-sm flex items-center",children:[(0,r.jsx)(eE.Z,{size:16,className:"mr-2"}),n]}),o?(0,r.jsxs)("div",{className:"p-3 text-center bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-300 rounded-md",children:[(0,r.jsx)(eA,{className:"inline-block mr-2"})," Bill sent successfully!"]}):(0,r.jsx)("button",{onClick:u,className:"w-full bg-green-600 text-white rounded-md px-4 py-2.5 text-sm font-semibold flex items-center justify-center",disabled:l,children:l?(0,r.jsx)(b.Z,{size:18,className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D.Z,{size:16,className:"mr-2"}),"Send Bill as Image"]})}),(0,r.jsx)("button",{onClick:a,className:"w-full mt-2 text-sm text-gray-600 dark:text-gray-400 py-2 hover:underline",children:"Done"})]})]})},eP=e=>{let{order:t,onBack:a,onFinalized:l,socket:d}=e,[n,i]=(0,s.useState)(t),[o,c]=(0,s.useState)(n.payments||[]),[u,m]=(0,s.useState)(null),[x,g]=(0,s.useState)(""),[h,y]=(0,s.useState)(!1),[p,f]=(0,s.useState)({amount:"",method:"Cash",notes:""}),[j,v]=(0,s.useState)(!1),k=o.reduce((e,t)=>e+t.amount,0),N=n.total-k;(0,s.useEffect)(()=>{if((async()=>{if(!n.id)return;let e=await fetch("/api/orders/".concat(n.id));if(e.ok){let t=await e.json();i(t),c(t.payments||[])}})(),d){let e=e=>{e.id===n.id&&(i(e),c(e.payments||[]))};return d.on("order_update",e),()=>{d.off("order_update",e)}}},[n.id,d]);let w=async e=>{m(e),g("");try{let t=await fetch("/api/orders/".concat(n.id,"/send-payment-action"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e})});if(!t.ok){let e=await t.json();throw Error(e.error||"Action failed.")}}catch(e){g(e.message)}finally{m(null)}},C=async e=>{e.preventDefault(),v(!0),g("");try{let e=await fetch("/api/orders/".concat(n.id,"/payments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...p,amount:parseFloat(p.amount)})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to add payment.");i(t),c(t.payments||[]),y(!1),f({amount:"",method:"Cash",notes:""})}catch(e){g(e.message)}finally{v(!1)}};return(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[x&&(0,r.jsx)("p",{className:"text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-300 p-2 rounded-md text-sm mb-2",children:x}),(0,r.jsxs)("div",{className:"p-3 border dark:border-gray-700 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-semibold text-sm mb-2 text-gray-800 dark:text-gray-100",children:"Payment Status"}),(0,r.jsxs)("div",{className:"text-sm space-y-1 text-gray-700 dark:text-gray-300",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Total Bill:"})," ",(0,r.jsxs)("span",{className:"font-bold text-gray-800 dark:text-gray-100",children:["₹",n.total.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Total Paid:"})," ",(0,r.jsxs)("span",{className:"font-bold text-green-600 dark:text-green-400",children:["₹",k.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Amount Due:"})," ",(0,r.jsxs)("span",{className:"font-bold text-red-600 dark:text-red-400",children:["₹",N.toFixed(2)]})]})]}),(0,r.jsx)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 max-h-24 overflow-y-auto",children:o.map(e=>(0,r.jsxs)("div",{className:"flex justify-between items-center border-t dark:border-gray-600 py-1",children:[(0,r.jsxs)("span",{children:[e.method," (",(0,V.WU)(new Date(e.createdAt),"PP"),")"]}),(0,r.jsxs)("span",{children:["₹",e.amount.toFixed(2)]})]},e.id))}),(0,r.jsxs)("button",{onClick:()=>y(!0),className:"w-full mt-3 flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 py-2 rounded-md",children:[(0,r.jsx)($.Z,{size:16,className:"mr-1"})," Record Manual Payment"]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-semibold text-sm pt-2 text-gray-800 dark:text-gray-100",children:"Payment Actions"}),(0,r.jsx)("button",{onClick:()=>w("send_bill_image"),disabled:!!u,className:"w-full flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 p-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"send_bill_image"===u?(0,r.jsx)(b.Z,{className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D.Z,{size:16,className:"mr-2"})," Send Bill Image"]})}),(0,r.jsx)("button",{onClick:()=>w("send_razorpay"),disabled:!!u||N<=0,className:"w-full flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 p-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"send_razorpay"===u?(0,r.jsx)(b.Z,{className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ex,{size:16,className:"mr-2"})," Send Payment Link"]})}),(0,r.jsx)("button",{onClick:()=>w("send_bank_details"),disabled:!!u||N<=0,className:"w-full flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 p-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"send_bank_details"===u?(0,r.jsx)(b.Z,{className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eg,{size:16,className:"mr-2"})," Send Bank Details"]})}),(0,r.jsx)("button",{onClick:()=>w("send_qr_code"),disabled:!!u||N<=0,className:"w-full flex items-center justify-center text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 p-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"send_qr_code"===u?(0,r.jsx)(b.Z,{className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eh,{size:16,className:"mr-2"})," Send UPI QR Code"]})})]}),(0,r.jsx)(F.Z,{isOpen:h,onClose:()=>y(!1),title:"Record Manual Payment",children:(0,r.jsxs)("form",{onSubmit:C,className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Amount"}),(0,r.jsx)("input",{type:"number",placeholder:"Amount paid",value:p.amount,onChange:e=>f(t=>({...t,amount:e.target.value})),required:!0,className:"w-full border rounded-md p-2 text-sm mt-1 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Method"}),(0,r.jsxs)("select",{value:p.method,onChange:e=>f(t=>({...t,method:e.target.value})),className:"w-full border rounded-md p-2 text-sm mt-1 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100",children:[(0,r.jsx)("option",{children:"Cash"})," ",(0,r.jsx)("option",{children:"Bank Transfer"})," ",(0,r.jsx)("option",{children:"UPI"})," ",(0,r.jsx)("option",{children:"Other"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notes (Optional)"}),(0,r.jsx)("input",{type:"text",placeholder:"e.g., Transaction ID",value:p.notes,onChange:e=>f(t=>({...t,notes:e.target.value})),className:"w-full border rounded-md p-2 text-sm mt-1 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:j,className:"px-4 py-2 text-sm bg-green-600 text-white rounded-md disabled:opacity-50",children:j?"Adding...":"Add Payment"})]})]})})]})},eT=a(9061),eI=e=>{let{name:t,color:a,onRemove:s}=e;return(0,r.jsxs)("div",{className:"flex items-center text-xs font-medium rounded-full px-2.5 py-1",style:{backgroundColor:"".concat(a,"20"),color:a},children:[(0,r.jsx)("span",{children:t}),s&&(0,r.jsx)("button",{type:"button",onClick:s,className:"ml-1.5 -mr-1 rounded-full hover:bg-black/10 p-0.5 transition-colors","aria-label":"Remove tag ".concat(t),children:(0,r.jsx)(f.Z,{size:12,style:{color:a}})})]})};let eF=["#3b82f6","#22c55e","#eab308","#f97316","#ef4444","#8b5cf6","#d946ef","#64748b"];var e_=e=>{let{tags:t,onTagsChange:a}=e,[l,d]=(0,s.useState)([]),[n,i]=(0,s.useState)(!1),[o,c]=(0,s.useState)(""),[u,m]=(0,s.useState)(eF[0]),[x,g]=(0,s.useState)(""),h=async()=>{let e=await fetch("/api/tags");e.ok&&d(await e.json())};(0,s.useEffect)(()=>{h()},[]);let y=e=>{if(!e)return;let r=l.find(t=>t.id===e);r&&!t.some(t=>t.id===e)&&a([...t,r])},b=e=>{a(t.filter(t=>t.id!==e))},p=async()=>{if(!o.trim()){g("Tag name cannot be empty.");return}g("");try{let e=await fetch("/api/tags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,color:u})}),r=await e.json();if(!e.ok)throw Error(r.error||"Failed to create tag.");await h(),a([...t,r]),c(""),m(eF[0]),i(!1)}catch(e){g(e.message)}},f=l.filter(e=>!t.some(t=>t.id===e.id));return(0,r.jsxs)("div",{className:"p-3 border dark:border-gray-700 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-semibold text-sm mb-2 text-gray-700 dark:text-gray-300",children:"Tags"}),x&&(0,r.jsx)("p",{className:"text-xs text-red-500 mb-2",children:x}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[t.map(e=>(0,r.jsx)(eI,{name:e.name,color:e.color,onRemove:()=>b(e.id)},e.id)),!n&&(0,r.jsxs)("button",{type:"button",onClick:()=>i(!0),className:"flex items-center text-xs text-blue-600 bg-blue-50 dark:bg-blue-900/30 px-2 py-1 rounded-full hover:bg-blue-100 dark:hover:bg-blue-900/50",children:[(0,r.jsx)($.Z,{size:12,className:"mr-1"})," Add Tag"]})]}),n&&(0,r.jsxs)("div",{className:"mt-3 space-y-2 animate-fade-in-up",style:{animationDuration:"0.3s"},children:[f.length>0&&(0,r.jsxs)("select",{onChange:e=>{y(e.target.value),e.target.value=""},className:"w-full border rounded-md p-1.5 text-sm dark:bg-gray-700 dark:border-gray-600",defaultValue:"",children:[(0,r.jsx)("option",{value:"",disabled:!0,children:"Add existing tag..."}),f.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsx)("p",{className:"text-xs text-center text-gray-500",children:"Or"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{value:o,onChange:e=>{c(e.target.value),g("")},placeholder:"Create new tag...",className:"flex-1 border rounded-md p-1.5 text-sm dark:bg-gray-700 dark:border-gray-600"}),(0,r.jsx)("div",{className:"flex gap-1 bg-gray-100 dark:bg-gray-900 p-1 rounded-md",children:eF.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>m(e),style:{backgroundColor:e},className:"w-5 h-5 rounded-full transition-transform hover:scale-110 ".concat(u===e?"ring-2 ring-offset-1 dark:ring-offset-gray-800 ring-blue-500":"")},e))})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 text-xs",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{i(!1),g("")},className:"px-3 py-1 border rounded-md dark:border-gray-600",children:"Cancel"}),(0,r.jsx)("button",{type:"button",onClick:p,className:"bg-blue-600 text-white px-3 py-1 rounded-md",children:"Create & Add"})]})]})]})},eM=e=>{var t,a;let{contact:l,onPromoted:d}=e,[n,i]=(0,s.useState)(null),[o,c]=(0,s.useState)(!0),[m,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)({name:"",shippingAddress:"",bankDetails:"",tags:[]}),[y,p]=(0,s.useState)(!1),[f,j]=(0,s.useState)(!1),[v,k]=(0,s.useState)(""),N=async()=>{c(!0),k("");try{let e=await fetch("/api/contacts/".concat(l.id,"/details"));if(!e.ok)throw Error("Failed to load details.");let t=await e.json();i(t),h({name:t.name||"",shippingAddress:t.shippingAddress||"",bankDetails:t.bankDetails||"",tags:t.tags||[]}),x(!t.isMasterCustomer)}catch(e){k(e.message)}finally{c(!1)}};(0,s.useEffect)(()=>{l.id&&N()},[l.id]);let w=async e=>{e.preventDefault(),p(!0),k("");try{let e=await fetch("/api/contacts/".concat(l.id,"/promote-to-master"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:g.name,shippingAddress:g.shippingAddress,bankDetails:g.bankDetails,tagIds:g.tags.map(e=>e.id)})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to save customer details.")}await N(),x(!1)}catch(e){k(e.message)}finally{p(!1)}},D=async()=>{if(window.confirm("Are you sure you want to remove this customer from master status?")){j(!0),k("");try{if(!(await fetch("/api/contacts/".concat(l.id,"/demote"),{method:"POST"})).ok)throw Error("Failed to demote customer.");d()}catch(e){k(e.message)}finally{j(!1)}}};return o?(0,r.jsxs)("div",{className:"p-4 text-center",children:[(0,r.jsx)(b.Z,{className:"animate-spin inline-block"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Loading Details..."})]}):v&&!n?(0,r.jsx)("p",{className:"p-4 text-red-600 bg-red-50 text-center",children:v}):m?(0,r.jsxs)("form",{onSubmit:w,className:"p-4 space-y-4",children:[(0,r.jsxs)("h3",{className:"font-semibold flex items-center text-yellow-500",children:[(0,r.jsx)(R,{size:18,className:"mr-2 fill-current"}),(null==n?void 0:n.isMasterCustomer)?"Edit Master Details":"Promote to Master Customer"]}),v&&(0,r.jsx)("p",{className:"text-red-600 bg-red-50 p-2 rounded-md text-sm",children:v}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium",children:["Customer Name ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",value:g.name,onChange:e=>h(t=>({...t,name:e.target.value})),className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-[var(--input-background)] dark:border-gray-600",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium",children:["Shipping Address ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{value:g.shippingAddress,onChange:e=>h(t=>({...t,shippingAddress:e.target.value})),rows:3,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-[var(--input-background)] dark:border-gray-600",placeholder:"Enter full shipping address...",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Bank Account Details"}),(0,r.jsx)("textarea",{value:g.bankDetails,onChange:e=>h(t=>({...t,bankDetails:e.target.value})),rows:3,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-[var(--input-background)] dark:border-gray-600",placeholder:"Bank Name, Account Number, IFSC Code..."})]}),(0,r.jsx)("div",{children:(0,r.jsx)(e_,{tags:g.tags,onTagsChange:e=>h(t=>({...t,tags:e}))})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(null==n?void 0:n.isMasterCustomer)&&(0,r.jsx)("button",{type:"button",onClick:()=>{n&&h({name:n.name||"",shippingAddress:n.shippingAddress||"",bankDetails:n.bankDetails||"",tags:n.tags||[]}),x(!1)},className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md",children:"Cancel"}),(0,r.jsxs)("button",{type:"submit",disabled:y,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md disabled:opacity-50 flex items-center",children:[y?(0,r.jsx)(b.Z,{className:"animate-spin mr-2"}):(0,r.jsx)(eT.Z,{className:"mr-2"}),y?"Saving...":"Save Details"]})]})]}):(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400",children:"Tags"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mt-1",children:[null==n?void 0:null===(t=n.tags)||void 0===t?void 0:t.map(e=>(0,r.jsx)(eI,{name:e.name,color:e.color},e.id)),(null==n?void 0:null===(a=n.tags)||void 0===a?void 0:a.length)===0&&(0,r.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500 italic",children:"No tags"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400",children:"Shipping Address"}),(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap p-2 bg-gray-50 dark:bg-[var(--input-background)] rounded-md mt-1",children:(null==n?void 0:n.shippingAddress)||(0,r.jsx)("span",{className:"italic text-gray-400 dark:text-gray-500",children:"Not provided"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400",children:"Bank Details"}),(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap p-2 bg-gray-50 dark:bg-[var(--input-background)] rounded-md mt-1",children:(null==n?void 0:n.bankDetails)||(0,r.jsx)("span",{className:"italic text-gray-400 dark:text-gray-500",children:"Not provided"})})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-2",children:[(0,r.jsxs)("button",{type:"button",onClick:D,disabled:f,className:"flex items-center text-xs text-red-500 hover:underline disabled:opacity-50",children:[f?(0,r.jsx)(b.Z,{size:14,className:"animate-spin mr-1"}):(0,r.jsx)(u.Z,{name:"UserX",size:14,className:"mr-1"}),"Demote Customer"]}),(0,r.jsxs)("button",{onClick:()=>x(!0),className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md flex items-center",children:[(0,r.jsx)(ed.Z,{size:16,className:"mr-2"})," Edit Details"]})]})]})};function eO(e){let{initialImages:t=[],onChange:a,label:l="Product Images"}=e,[d,n]=(0,s.useState)(t),[i,o]=(0,s.useState)(!1),c=async e=>{if(!e.target.files||0===e.target.files.length)return;o(!0);let t=[...d],r=e.target.files;for(let e=0;e<r.length;e++){let a=r[e],l=new FormData;l.append("image",a);try{let e="https://api.imgbb.com/1/upload?key=".concat("ce388deb1931d0d58b9e876d99c2b152"),a=await fetch(e,{method:"POST",body:l}),r=await a.json();if(a.ok&&r.data&&r.data.url)t.push(r.data.url);else{var s;console.error("ImgBB upload failed:",(null===(s=r.error)||void 0===s?void 0:s.message)||"Unknown error")}}catch(e){console.error("ImgBB upload error:",e)}}n(t),a(t),o(!1)},u=e=>{let t=d.filter(t=>t!==e);n(t),a(t)};return(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l}),(0,r.jsx)("input",{type:"file",accept:"image/jpeg, image/png",multiple:!0,onChange:c,disabled:i,className:"mt-1 block w-full text-sm text-gray-700 dark:text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-blue-900/50 file:text-blue-700 dark:file:text-blue-300 hover:file:bg-blue-100 dark:hover:file:bg-blue-900"}),i&&(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Uploading..."}),d.length>0&&(0,r.jsx)("div",{className:"mt-3 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2",children:d.map((e,t)=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:e,alt:"preview-".concat(t),className:"h-24 w-full object-cover rounded-md border dark:border-gray-600"}),(0,r.jsx)("button",{type:"button",onClick:()=>u(e),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 text-xs leading-none",children:"✕"})]},t))})]})}function ez(e){let{onSuccess:t,onCancel:a}=e,[l,d]=(0,s.useState)(""),[n,i]=(0,s.useState)(""),[o,c]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[x,g]=(0,s.useState)("0"),[h,y]=(0,s.useState)(!0),[b,p]=(0,s.useState)("HYBRID"),[f,j]=(0,s.useState)(!1),[v,k]=(0,s.useState)(""),[N,w]=(0,s.useState)([]),D=async e=>{e.preventDefault(),k(""),j(!0);try{let e=await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,price:n,description:o,category:u,inStock:h,stockQuantity:x,images:N,workflow:b})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to add product")}await e.json(),t()}catch(e){console.error("AddProductForm error:",e),k(e.message||"Something went wrong")}finally{j(!1)}};return(0,r.jsxs)("form",{onSubmit:D,className:"bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg p-4 shadow-md",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Add New Product"}),v&&(0,r.jsx)("p",{className:"text-red-600 text-sm mb-3",children:v}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Product Usage / Workflow",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{required:!0,value:b,onChange:e=>p(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"QUOTATION_FOCUSED",children:"Quotation Specific"}),(0,r.jsx)("option",{value:"ORDER_FOCUSED",children:"Order Specific"}),(0,r.jsx)("option",{value:"HYBRID",children:"Hybrid (for both)"})]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Name",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",required:!0,value:l,onChange:e=>d(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Price (₹)",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"number",required:!0,value:n,onChange:e=>i(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Stock Quantity"}),(0,r.jsx)("input",{type:"number",value:x,onChange:e=>g(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),(0,r.jsx)("textarea",{value:o,onChange:e=>c(e.target.value),rows:3,className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsx)(eO,{onChange:w})}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category"}),(0,r.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:h,onChange:e=>y(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsx)("label",{className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"In Stock"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:f,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:f?"Adding...":"Add Product"})]})]})}function eq(e){var t;let{product:a,onSuccess:l,onCancel:d}=e,[n,i]=(0,s.useState)(a.name),[o,c]=(0,s.useState)(a.price.toString()),[u,m]=(0,s.useState)(a.description||""),[x,g]=(0,s.useState)(a.category||""),[h,y]=(0,s.useState)((a.stockQuantity||0).toString()),[b,p]=(0,s.useState)(null===(t=a.inStock)||void 0===t||t),[f,j]=(0,s.useState)(a.workflow||"HYBRID"),[v,k]=(0,s.useState)(!1),[N,w]=(0,s.useState)(""),[D,C]=(0,s.useState)(a.images||[]),[S,E]=(0,s.useState)([]),[A,Z]=(0,s.useState)([]),P=e=>{C(t=>t.filter(t=>t.id!==e)),E(t=>[...t,e])},T=async e=>{e.preventDefault(),w(""),k(!0);try{let e=await fetch("/api/products/".concat(a.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,price:o,description:u,category:x,inStock:b,stockQuantity:h,workflow:f,imagesToAdd:A,imagesToDelete:S})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to update product")}await e.json(),l()}catch(e){console.error("EditProductForm error:",e),w(e.message||"Something went wrong")}finally{k(!1)}};return(0,r.jsxs)("form",{onSubmit:T,className:"bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg p-4 shadow-md",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Edit Product"}),N&&(0,r.jsx)("p",{className:"text-red-600 text-sm mb-3",children:N}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Product Usage / Workflow",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{required:!0,value:f,onChange:e=>j(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"QUOTATION_FOCUSED",children:"Quotation Specific"}),(0,r.jsx)("option",{value:"ORDER_FOCUSED",children:"Order Specific"}),(0,r.jsx)("option",{value:"HYBRID",children:"Hybrid (for both)"})]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),(0,r.jsx)("input",{type:"text",required:!0,value:n,onChange:e=>i(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Price (₹)"}),(0,r.jsx)("input",{type:"number",required:!0,value:o,onChange:e=>c(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Stock Quantity"}),(0,r.jsx)("input",{type:"number",value:h,onChange:e=>y(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),(0,r.jsx)("textarea",{value:u,onChange:e=>m(e.target.value),rows:3,className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),D.length>0&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Existing Images"}),(0,r.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:D.map(e=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:e.url,alt:"product",className:"h-24 w-full object-cover rounded-md border dark:border-gray-600"}),(0,r.jsx)("button",{type:"button",onClick:()=>P(e.id),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 text-xs",children:"✕"})]},e.id))})]}),(0,r.jsx)(eO,{label:"Add New Images",initialImages:A,onChange:Z}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category"}),(0,r.jsx)("input",{type:"text",value:x,onChange:e=>g(e.target.value),className:"mt-1 w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:b,onChange:e=>p(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsx)("label",{className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"In Stock"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:v,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:v?"Saving...":"Save Changes"})]})]})}var eL=e=>{let{quotation:t,onClose:a,onSend:s,isSending:l,error:d}=e;return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col",children:[(0,r.jsxs)("header",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-gray-800 dark:text-gray-100",children:"Quotation Preview"}),(0,r.jsx)("button",{onClick:a,children:(0,r.jsx)(f.Z,{})})]}),(0,r.jsxs)("main",{className:"p-6 overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"To:"})," ",t.customerName]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Phone:"})," ",t.contactNumber]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Date:"})," ",new Date(t.createdAt).toLocaleDateString()]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-500 dark:text-gray-400",children:"Billing Address"}),(0,r.jsx)("p",{className:"whitespace-pre-wrap text-gray-700 dark:text-gray-300",children:t.billingAddress})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-500 dark:text-gray-400",children:"Shipping Address"}),(0,r.jsx)("p",{className:"whitespace-pre-wrap text-gray-700 dark:text-gray-300",children:t.shippingAddress})]})]}),(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-gray-100 dark:bg-gray-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2",children:"Product"}),(0,r.jsx)("th",{className:"p-2 text-center",children:"Qty"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"Price"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"Subtotal"})]})}),(0,r.jsx)("tbody",{children:t.items.map(e=>{var t;return(0,r.jsxs)("tr",{className:"border-b dark:border-gray-600",children:[(0,r.jsx)("td",{className:"p-2",children:null===(t=e.product)||void 0===t?void 0:t.name}),(0,r.jsx)("td",{className:"p-2 text-center",children:e.quantity}),(0,r.jsxs)("td",{className:"p-2 text-right",children:["₹",e.price.toFixed(2)]}),(0,r.jsxs)("td",{className:"p-2 text-right",children:["₹",(e.price*e.quantity).toFixed(2)]})]},e.id)})})]}),(0,r.jsxs)("div",{className:"mt-4 text-right",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Subtotal:"})," ₹",t.subtotal.toFixed(2)]}),(0,r.jsxs)("p",{className:"font-bold text-xl",children:[(0,r.jsx)("strong",{children:"Total:"})," ₹",t.total.toFixed(2)]})]})]}),(0,r.jsxs)("footer",{className:"p-4 border-t dark:border-gray-700 flex flex-col",children:[d&&(0,r.jsxs)("div",{className:"p-2 mb-2 bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-300 rounded-md text-sm flex items-center",children:[(0,r.jsx)(eE.Z,{size:16,className:"mr-2"}),d]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{onClick:a,className:"border dark:border-gray-600 rounded-md px-4 py-2 text-sm",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>s(t.id),className:"bg-green-600 text-white rounded-md px-4 py-2 text-sm flex items-center justify-center w-40",disabled:l,children:l?(0,r.jsx)(b.Z,{size:18,className:"animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D.Z,{size:16,className:"mr-2"}),"Send to Customer"]})})]})]})]})}):null},eU=a(998);let eR={initial:{opacity:0,y:10},enter:{opacity:1,y:0,transition:{duration:.3,ease:[.4,0,.2,1]}},exit:{opacity:0,y:-10,transition:{duration:.2,ease:[.4,0,1,1]}}},eB={visible:{transition:{staggerChildren:.06}}},eQ={hidden:{y:15,opacity:0},visible:{y:0,opacity:1,transition:{ease:"easeOut",duration:.3}}};var eH=e=>{let{activeContact:t,messages:a,onShareProduct:l,initialViewId:d="main_menu",socket:n,newAddressForOrder:i,onClosePanel:o}=e,{data:c}=(0,eU.useSession)(),[u,g]=(0,s.useState)(d),[h,y]=(0,s.useState)([]),[p,j]=(0,s.useState)(null),[v,k]=(0,s.useState)(null),[N,w]=(0,s.useState)(null),[D,C]=(0,s.useState)(null),[S,E]=(0,s.useState)(null),[A,Z]=(0,s.useState)(!1),[P,T]=(0,s.useState)(null),[I,_]=(0,s.useState)(0),[M,O]=(0,s.useState)(!1),[z,q]=(0,s.useState)(null),[L,U]=(0,s.useState)(null),[R,B]=(0,s.useState)(null),[Q,H]=(0,s.useState)([]),[J,V]=(0,s.useState)(!1),W=async()=>{try{B(null);let e=await fetch("/api/products");if(!e.ok)throw Error("Failed to fetch products");let t=(await e.json()).map(e=>{var t,a;return{...e,imageUrl:(null===(a=e.images)||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.url)||"https://i.imgur.com/vJkrA4g.png"}});return y(t),t}catch(e){return console.error("Failed to fetch products:",e),B(e.message),[]}},Y=async()=>{if(a&&0!==a.length){V(!0),H([]),B(null),g("products");try{let e=h.length>0?h:await W(),t=a.slice(-10).map(e=>"".concat("business"===e.from?"Business":"Customer",": ").concat(e.text||"[attachment]")).join("\n"),r=await fetch("/api/ai/suggest-products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({history:t})});if(!r.ok){let e="Failed to get AI suggestions.";try{e=(await r.json()).error||e}catch(t){console.error("Server returned a non-JSON error response for AI suggestions."),e="An unexpected error occurred on the server. Please try again later."}throw Error(e)}let{query:s}=await r.json();if(s){let t=s.toLowerCase(),a=e.filter(e=>{var a,r;return e.name.toLowerCase().includes(t)||(null===(a=e.description)||void 0===a?void 0:a.toLowerCase().includes(t))||(null===(r=e.category)||void 0===r?void 0:r.toLowerCase().includes(t))});H(a),0===a.length&&B('AI suggested searching for "'.concat(s,'", but no products matched.'))}else B("AI couldn't determine a product suggestion from the chat.")}catch(e){B(e.message||"An error occurred while getting suggestions.")}finally{V(!1)}}};(0,s.useEffect)(()=>{d&&g(d)},[d]),(0,s.useEffect)(()=>{"products"!==u||0!==h.length||J||W()},[u,J,h.length]);let G=async()=>{if(L){B(null);try{let e=await fetch("/api/products/".concat(L.id),{method:"DELETE"});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to delete product.")}W(),U(null)}catch(e){B(e.message)}}},K=()=>{B(null),H([]),"order_billing"===u||"new_order"===u||"order_summary"===u?g("order_history"):"billing"===u||"new_quotation"===u||"new_reminder"===u?g("quotations"):g("main_menu"),C(null)},es=()=>{g("main_menu")},ed=e=>{g("quotations"),E(e),_(e=>e+1)},en=e=>{C(e),g("order_summary")},ei=async e=>{Z(!0),T(null);try{let t=await fetch("/api/quotations/".concat(e,"/send-as-image"),{method:"POST"});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to send quotation image.")}E(null),_(e=>e+1)}catch(e){T(e.message)}finally{Z(!1)}};return(0,r.jsxs)("aside",{className:"w-full md:w-[30%] md:min-w-[380px] md:max-w-[450px] bg-white dark:bg-[var(--header-background)] border-l border-gray-200 dark:border-[var(--card-border)] flex flex-col flex-shrink-0",children:[(()=>{let e={main_menu:"Contact Actions",products:"Products",quotations:"Quotations",new_quotation:"New Quotation",new_reminder:"Set Follow-up Reminder",billing:"Bill for #".concat(null==p?void 0:p.id.substring(0,6)),master_customer_details:"Customer Details",order_history:"Orders",new_order:"New Order",order_summary:"Order Summary",order_billing:"Bill for #".concat(null==N?void 0:N.id.substring(0,6))};return(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-[var(--card-border)] flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:["main_menu"!==u&&(0,r.jsx)("button",{onClick:K,className:"mr-3 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,r.jsx)(X.Z,{size:20})}),(0,r.jsx)("h2",{className:"text-xl font-bold",children:e[u]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:["products"===u&&(0,r.jsxs)("button",{onClick:()=>O(!0),className:"bg-blue-600 text-white px-3 py-1.5 rounded-md flex items-center text-sm font-semibold hover:bg-blue-700",children:[(0,r.jsx)($.Z,{size:16,className:"mr-1"})," Add New"]}),o&&(0,r.jsx)("button",{onClick:o,className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 md:hidden",children:(0,r.jsx)(f.Z,{size:20})})]})]})})(),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[R&&(0,r.jsx)("div",{className:"p-4 m-2 bg-red-50 text-red-700 rounded-md text-sm",children:R}),(0,r.jsx)(x.M,{mode:"wait",children:(0,r.jsx)(m.E.div,{variants:eR,initial:"initial",animate:"enter",exit:"exit",children:(()=>{let e;if(!t)return(0,r.jsx)("p",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"Please select a contact."});switch(u){case"products":e=(0,r.jsxs)("div",{children:[J&&(0,r.jsxs)("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:[(0,r.jsx)(b.Z,{className:"animate-spin inline-block mr-2"}),"Analyzing chat for suggestions..."]}),Q.length>0&&(0,r.jsxs)("div",{className:"p-2 border-b-2 border-dashed dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2 px-2",children:[(0,r.jsx)("h4",{className:"font-bold text-blue-600 dark:text-blue-400",children:"AI Suggestions"}),(0,r.jsx)("button",{onClick:()=>H([]),className:"text-xs text-gray-500 hover:underline",children:"Clear"})]}),(0,r.jsx)(el,{products:Q,onShareProduct:l,onEditProduct:e=>q(e),onDeleteProduct:e=>U(e)})]}),(0,r.jsx)(el,{products:h,onShareProduct:l,onEditProduct:e=>q(e),onDeleteProduct:e=>U(e)})]});break;case"quotations":e=(0,r.jsx)(em,{contactId:t.id,onNewQuote:()=>g("new_quotation"),onBillQuote:e=>{j(e),g("billing")},onSendDraft:e=>E(e),onSetFollowUp:e=>{k(e),g("new_reminder")}},I);break;case"new_quotation":e=(0,r.jsx)(ep,{contact:t,onCancel:()=>g("quotations"),onQuotationCreated:ed});break;case"new_reminder":if(!v)return null;e=(0,r.jsx)(ev,{quotation:v,onCancel:()=>g("quotations"),onSuccess:()=>g("quotations")});break;case"order_history":e=(0,r.jsx)(eS,{contactId:t.id,onNewOrder:()=>g("new_order"),onManagePayments:e=>{w(e),g("order_billing")}});break;case"new_order":e=(0,r.jsx)(eN,{contact:t,onCancel:()=>g("order_history"),onOrderCreated:en,suggestedAddress:i});break;case"order_summary":if(!D)return null;e=(0,r.jsx)(eZ,{order:D,onDone:K});break;case"billing":if(!p)return null;e=(0,r.jsx)(ey,{quotation:p,onBack:()=>g("quotations"),onFinalized:()=>{},socket:n});break;case"order_billing":if(!N)return null;e=(0,r.jsx)(eP,{order:N,onBack:()=>g("order_history"),onFinalized:()=>{},socket:n});break;case"master_customer_details":e=(0,r.jsx)(eM,{contact:t,onPromoted:es});break;default:var a;let s=null==c?void 0:null===(a=c.user)||void 0===a?void 0:a.primaryWorkflow,d="QUOTATION_FOCUSED"===s,o="ORDER_FOCUSED"===s,x=[{id:"orders",label:"Manage Orders",icon:(0,r.jsx)(ee.Z,{className:"mr-3 ".concat(d?"text-gray-400 dark:text-gray-500":"text-blue-600 dark:text-blue-400")}),action:()=>g("order_history"),disabled:d},{id:"quotations",label:"Manage Quotations",icon:(0,r.jsx)(et.Z,{className:"mr-3 ".concat(o?"text-gray-400 dark:text-gray-500":"text-green-600 dark:text-green-400")}),action:()=>g("quotations"),disabled:o}];"QUOTATION_FOCUSED"===s&&x.reverse(),e=(0,r.jsxs)(m.E.div,{className:"p-4 space-y-3",variants:eB,initial:"hidden",animate:"visible",children:[x.map(e=>(0,r.jsxs)(m.E.button,{variants:eQ,onClick:e.action,disabled:e.disabled,className:"w-full flex items-center p-3 text-left rounded-lg transition-colors ".concat(e.disabled?"bg-gray-100 dark:bg-gray-800/50 text-gray-400 dark:text-gray-500 cursor-not-allowed":"bg-gray-50 hover:bg-gray-100 dark:bg-[var(--input-background)] dark:hover:bg-gray-700"),title:e.disabled?"".concat(e.label," (Disabled in this workspace)"):e.label,children:[e.icon," ",e.label]},e.id)),(0,r.jsxs)(m.E.button,{variants:eQ,onClick:Y,className:"w-full flex items-center p-3 text-left bg-gray-50 hover:bg-gray-100 dark:bg-[var(--input-background)] dark:hover:bg-gray-700 rounded-lg",children:[(0,r.jsx)(ea,{className:"mr-3 text-yellow-500 dark:text-yellow-400"})," Suggest Products"]}),(0,r.jsxs)(m.E.button,{variants:eQ,onClick:()=>g("products"),className:"w-full flex items-center p-3 text-left bg-gray-50 hover:bg-gray-100 dark:bg-[var(--input-background)] dark:hover:bg-gray-700 rounded-lg",children:[(0,r.jsx)(ee.Z,{className:"mr-3 text-orange-600 dark:text-orange-400"})," Share Product"]}),(0,r.jsxs)(m.E.button,{variants:eQ,onClick:()=>g("master_customer_details"),className:"w-full flex items-center p-3 text-left bg-gray-50 hover:bg-gray-100 dark:bg-[var(--input-background)] dark:hover:bg-gray-700 rounded-lg",children:[(0,r.jsx)(er,{className:"mr-3 text-purple-600 dark:text-purple-400"})," Customer Details"]})]})}return e})()},u)})]}),(0,r.jsx)(F.Z,{isOpen:M,onClose:()=>O(!1),title:"Add New Product",children:(0,r.jsx)(ez,{onSuccess:()=>{O(!1),W()},onCancel:()=>O(!1)})}),z&&(0,r.jsx)(F.Z,{isOpen:!!z,onClose:()=>q(null),title:"Edit Product",children:(0,r.jsx)(eq,{product:z,onSuccess:()=>{q(null),W()},onCancel:()=>q(null)})}),L&&(0,r.jsxs)(F.Z,{isOpen:!!L,onClose:()=>U(null),title:"Confirm Deletion",children:[(0,r.jsxs)("p",{children:["Are you sure you want to delete the product: ",(0,r.jsx)("strong",{children:L.name}),"?"]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,r.jsx)("button",{onClick:()=>U(null),className:"px-4 py-2 border rounded-md",children:"Cancel"}),(0,r.jsx)("button",{onClick:G,className:"px-4 py-2 bg-red-600 text-white rounded-md",children:"Delete"})]})]}),S&&(0,r.jsx)(eL,{quotation:S,onClose:()=>{E(null),T(null)},onSend:ei,isSending:A,error:P})]})},eJ=a(4262);let eV=()=>(0,r.jsxs)("div",{className:"w-full flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"p-4 border-b dark:border-[var(--card-border)] flex items-center",children:[(0,r.jsx)(i.Z,{className:"w-10 h-10 rounded-full mr-3"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(i.Z,{className:"h-5 w-1/3 mb-1"}),(0,r.jsx)(i.Z,{className:"h-3 w-1/4"})]})]}),(0,r.jsxs)("div",{className:"flex-1 p-4 space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-start",children:[" ",(0,r.jsx)(i.Z,{className:"h-10 w-2/5 rounded-lg"})," "]}),(0,r.jsxs)("div",{className:"flex justify-end",children:[" ",(0,r.jsx)(i.Z,{className:"h-16 w-3/5 rounded-lg"})," "]}),(0,r.jsxs)("div",{className:"flex justify-start",children:[" ",(0,r.jsx)(i.Z,{className:"h-8 w-1/3 rounded-lg"})," "]}),(0,r.jsxs)("div",{className:"flex justify-end",children:[" ",(0,r.jsx)(i.Z,{className:"h-12 w-1/2 rounded-lg"})," "]})]}),(0,r.jsx)("div",{className:"p-4 border-t dark:border-[var(--card-border)]",children:(0,r.jsx)(i.Z,{className:"h-12 w-full rounded-full"})})]});var eW=()=>(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[(0,r.jsxs)("div",{className:"w-80 border-r dark:border-[var(--card-border)] flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b dark:border-[var(--card-border)]",children:[(0,r.jsx)(i.Z,{className:"h-6 w-1/3 mb-4"}),(0,r.jsx)(i.Z,{className:"h-9 w-full rounded-md"})]}),(0,r.jsx)(c,{})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col",children:(0,r.jsx)(eV,{})})]});function eY(){let e=(0,l.useSearchParams)(),t=e.get("contactId"),a=e.get("message"),[d,n]=(0,s.useState)([]),[i,o]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[m,x]=(0,s.useState)([]),[g,h]=(0,s.useState)(null),[y,b]=(0,s.useState)(null),[p,f]=(0,s.useState)(0),[j,v]=(0,s.useState)("main_menu"),[k,N]=(0,s.useState)(!1),[w,D]=(0,s.useState)(!1),[C,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{u((0,eJ.h)())},[]);let E=async()=>{try{let e=await fetch("/api/contacts");if(e.ok){let t=await e.json(),a=t.contacts;if(Array.isArray(a))return n(a),a;console.error("API response for contacts is not an array:",t)}}catch(e){console.error("Failed to fetch contacts",e)}return[]};(0,s.useEffect)(()=>{E().then(e=>{if(t){let r=e.find(e=>e.id===t);r&&(o(r),a&&h(a))}})},[t,a]),(0,s.useEffect)(()=>{if(!c)return;let e=e=>{if(e.contactId===(null==i?void 0:i.id)&&x(t=>t.some(t=>t.id===e.id)?t:[...t,e]),w&&"customer"===e.from&&e.text){let t=e.text.trim().toLowerCase();"yes"!==t&&"yep"!==t&&"ok"!==t&&"confirm"!==t&&S(e.text),D(!1)}n(t=>{let a=Array.isArray(t)?t:[],r=!1,s=a.map(t=>t.id===e.contactId?(r=!0,{...t,lastMessage:e.text||"Sent a ".concat(e.type),lastMessageAt:e.createdAt,unreadCount:t.id===(null==i?void 0:i.id)?0:(t.unreadCount||0)+("customer"===e.from?1:0)}):t);return r?s.sort((e,t)=>new Date(t.lastMessageAt||0).getTime()-new Date(e.lastMessageAt||0).getTime()):(E(),t)})},t=e=>{x(t=>t.map(t=>t.wamid===e.wamid||t.id===e.id?{...t,status:e.status,wamid:t.wamid||e.wamid}:t))},a=e=>{let{messageId:t}=e;x(e=>e.filter(e=>e.id!==t))},r=e=>{n(t=>(Array.isArray(t)?t:[]).map(t=>t.id===e.id?{...t,...e}:t)),(null==i?void 0:i.id)===e.id&&o(t=>t?{...t,...e}:e)};return c.on("newMessage",e),c.on("message-status-update",t),c.on("deleteMessage",a),c.on("contact_updated",r),()=>{c.off("newMessage",e),c.off("message-status-update",t),c.off("deleteMessage",a),c.off("contact_updated",r)}},[c,i,w]),(0,s.useEffect)(()=>{(null==i?void 0:i.id)?((async()=>{x([]),b(null);let e=await fetch("/api/messages?contactId=".concat(i.id));if(e.ok){let{messages:t,nextCursor:a}=await e.json();x(t),b(a)}})(),fetch("/api/contacts/".concat(i.id,"/reset-unread"),{method:"POST"}),n(e=>(Array.isArray(e)?e:[]).map(e=>e.id===i.id?{...e,unreadCount:0}:e))):(x([]),b(null)),N(!1)},[null==i?void 0:i.id]);let A=async e=>{i&&(x(t=>[...t,{id:"temp-".concat(Date.now()),from:"business",to:i.phone,type:"product",text:"Sharing ".concat(e.name,"..."),createdAt:new Date().toISOString(),contactId:i.id,status:"pending",product:e}]),await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactId:i.id,type:"product",productId:e.id})}))},Z=async()=>{if(!i)return;S(null),v("new_order"),f(e=>e+1),N(!0);let e="";e=i.lastShippingAddress?"Hi ".concat(i.name,", we're creating a new order for you. Should we use your last known address for delivery?\n\n").concat(i.lastShippingAddress,"\n\nPlease reply with 'Yes' to confirm, or provide a new address."):"Hi ".concat(i.name,", we're creating a new order for you. What is the delivery address?"),D(!0),await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactId:i.id,text:e})})};return(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[(0,r.jsx)("div",{className:"flex-1 ".concat(k?"hidden":"flex"," md:flex flex-col"),children:(0,r.jsx)(K,{socket:c,contacts:d,setContacts:n,activeContact:i,onSelectContact:e=>{(null==i?void 0:i.id)!==(null==e?void 0:e.id)&&(o(e),v("main_menu"),f(e=>e+1),h(null))},onPromoteCustomer:()=>{v("master_customer_details"),f(e=>e+1),N(!0)},messages:m,setMessages:x,initialMessage:g,initialCursor:y,onCreateOrder:Z,onShowPanel:()=>N(!0)})}),i&&(0,r.jsx)("div",{className:"".concat(k?"flex":"hidden"," md:flex w-full md:w-auto flex-col h-full"),children:(0,r.jsx)(eH,{activeContact:i,messages:m,onShareProduct:A,initialViewId:j,socket:c,newAddressForOrder:C,onClosePanel:()=>N(!1)},p)})]})}function eG(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)(eW,{}),children:(0,r.jsx)(eY,{})})}},4727:function(e,t,a){"use strict";var r=a(7437);a(2265);let s={PENDING:{label:"Pending",className:"bg-yellow-100 text-yellow-800"},CONFIRMED:{label:"Confirmed",className:"bg-blue-100 text-blue-700"},SHIPPED:{label:"Shipped",className:"bg-indigo-100 text-indigo-700"},DELIVERED:{label:"Delivered",className:"bg-green-100 text-green-700"},CANCELLED:{label:"Cancelled",className:"bg-red-100 text-red-700"}};t.Z=e=>{let{status:t}=e,a=s[t]||{label:"Unknown",className:"bg-gray-100 text-gray-700"};return(0,r.jsx)("span",{className:"px-2.5 py-1 text-xs font-semibold rounded-full inline-block ".concat(a.className),children:a.label})}},1065:function(e,t,a){"use strict";var r=a(7437);a(2265),t.Z=e=>{let{initials:t,className:a=""}=e;return(0,r.jsx)("div",{className:"flex items-center justify-center h-9 w-9 rounded-full bg-gray-300 text-gray-600 font-bold ".concat(a),children:t})}},9788:function(e,t,a){"use strict";var r=a(7437);a(2265);var s=a(4207),l=a(6780),d=a(5137),n=a(8711),i=a(2468),o=a(2638),c=a(933),u=a(8314),m=a(6935),x=a(1077),g=a(7164),h=a(6649),y=a(9827),b=a(2023),p=a(404),f=a(8604),j=a(690),v=a(7140),k=a(9100),N=a(4453),w=a(7583),D=a(7524),C=a(6863),S=a(5404),E=a(4258),A=a(1510),Z=a(1125),P=a(3907),T=a(8637),I=a(883),F=a(2022),_=a(3267),M=a(9099),O=a(1240),z=a(4697);let q={activity:s.Z,alertCircle:l.Z,arrowLeft:d.Z,barChart3:n.Z,check:i.Z,checkCheck:o.Z,clock:c.Z,combine:u.Z,creditCard:m.Z,dollarSign:x.Z,download:g.Z,edit:h.Z,file:y.Z,fileText:b.Z,filter:p.Z,image:f.Z,info:j.Z,layoutDashboard:v.Z,lineChart:k.Z,lock:N.Z,messageCircle:w.Z,package:D.Z,pieChart:C.Z,radio:S.Z,settings:E.Z,share2:A.Z,slidersHorizontal:Z.Z,sparkles:P.Z,sunrise:T.Z,trash2:I.Z,user:F.Z,userPlus:_.Z,userX:M.Z,users:O.Z,x:z.Z},L=e=>e?e.charAt(0).toLowerCase()+e.slice(1):"alertCircle";t.Z=e=>{let{name:t,...a}=e,s=L(t),d=q[s];return d?(0,r.jsx)(d,{...a}):(console.warn('Icon "'.concat(t,'" (normalized to "').concat(s,'") not found in the icon map. Rendering a fallback icon.')),(0,r.jsx)(l.Z,{...a,color:"red"}))}},5260:function(e,t,a){"use strict";var r=a(7437);a(2265),t.Z=e=>{let{isOpen:t,onClose:a,title:s,children:l}=e;return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",onClick:a,children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md m-4",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:s}),(0,r.jsx)("button",{onClick:a,className:"text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:"\xd7"})]}),(0,r.jsx)("div",{className:"p-4",children:l})]})}):null}},1339:function(e,t,a){"use strict";var r=a(7437);a(2265),t.Z=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}("animate-pulse rounded-md bg-gray-200 dark:bg-gray-700",t),...a})}},4262:function(e,t,a){"use strict";a.d(t,{h:function(){return l}});var r=a(5040);let s=null,l=()=>(s||((s=(0,r.io)({path:"/socket.io",reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:2e3})).on("connect",()=>{console.log("✅ Socket connected:",s.id)}),s.on("disconnect",e=>{console.log("❌ Socket disconnected:",e)}),s.on("connect_error",e=>{console.error("Socket connection error:",e.message,e)})),s.disconnected&&s.connect(),s)},2781:function(e,t,a){"use strict";a.d(t,{E:function(){return l}});var r=a(4546),s=a(1880);function l(e,t){let a=(0,r.Q)(e);return isNaN(t)?(0,s.L)(e,NaN):(t&&a.setDate(a.getDate()+t),a)}}},function(e){e.O(0,[862,998,305,792,292,563,50,971,23,744],function(){return e(e.s=6190)}),_N_E=e.O()}]);