(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{441:function(e,t,s){Promise.resolve().then(s.bind(s,6981))},2513:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(8030).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5404:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(8030).Z)("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]])},994:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(8030).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},6981:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(7437),r=s(2265),l=s(2513),i=s(5404),n=s(3258),d=s(9302),c=s(5260);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,s(8030).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var m=s(3274),x=s(994),p=s(8274),h=e=>{let{isOpen:t,onClose:s,onSuccess:l}=e,[i,n]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[u,g]=(0,r.useState)(""),[y,f]=(0,r.useState)(""),[j,b]=(0,r.useState)(null),[k,N]=(0,r.useState)(!1),[w,v]=(0,r.useState)("");(0,r.useEffect)(()=>{t&&((async()=>{let e=await fetch("/api/tags");e.ok&&n(await e.json())})(),h([]),g(""),f(""),v(""),b(null))},[t]);let C=async e=>{if(e.preventDefault(),0===d.length){v("Please select at least one target tag.");return}if(!j&&!y){v("A Template Name is required for text-only broadcasts.");return}N(!0),v("");try{let e=await fetch("/api/broadcasts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tagIds:d,message:u,templateId:y,imageUrl:j})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to send broadcast.");l()}catch(e){v(e.message)}finally{N(!1)}};return(0,a.jsx)(c.Z,{isOpen:t,onClose:s,title:"Create New Broadcast",children:(0,a.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[w&&(0,a.jsx)("p",{className:"text-red-600 bg-red-50 p-2 rounded-md text-sm",children:w}),(0,a.jsxs)("div",{className:"p-3 bg-yellow-50 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-md text-sm flex items-start",children:[(0,a.jsx)(o,{className:"w-8 h-8 mr-2 flex-shrink-0"}),(0,a.jsxs)("span",{children:[(0,a.jsx)("b",{children:"Important:"})," To comply with WhatsApp policies, you must send a pre-approved Meta Template Message for text-only broadcasts."]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Target Audience (Tags)"}),(0,a.jsx)("div",{className:"mt-2 border rounded-md max-h-32 overflow-y-auto p-2 space-y-1",children:i.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-2 p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:d.includes(e.id),onChange:()=>h(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),className:"h-4 w-4 text-blue-600 rounded"}),(0,a.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Image (Optional)"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(p.Z,{onUpload:e=>b(e),initialUrl:j})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"template-id",className:"flex items-center text-sm font-medium",children:"Template Name / ID"}),(0,a.jsx)("input",{id:"template-id",type:"text",value:y,onChange:e=>f(e.target.value),required:!j,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g., hello_world (required if no image)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"message",className:"text-sm font-medium",children:"Message Content / Caption"}),(0,a.jsx)("textarea",{id:"message",value:u,onChange:e=>g(e.target.value),rows:4,required:!0,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600",placeholder:j?"Enter a caption for your image...":"This message text must EXACTLY match your approved template content."})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md",children:"Cancel"}),(0,a.jsxs)("button",{type:"submit",disabled:k,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md disabled:opacity-50 flex items-center",children:[k?(0,a.jsx)(m.Z,{className:"animate-spin mr-2"}):(0,a.jsx)(x.Z,{size:16,className:"mr-2"}),"Send Broadcast"]})]})]})})},u=s(7138),g=s(1513),y=s(4446),f=()=>{let[e,t]=(0,r.useState)([]),[s,c]=(0,r.useState)(!0),[o,m]=(0,r.useState)(!1),x=(0,r.useCallback)(async()=>{c(!0);try{let e=await fetch("/api/broadcasts");e.ok&&t(await e.json())}catch(e){console.error("Failed to fetch broadcasts",e)}finally{c(!1)}},[]);return((0,r.useEffect)(()=>{x()},[x]),s)?(0,a.jsx)("div",{className:"p-8 text-center flex items-center justify-center h-full",children:(0,a.jsx)(n.Z,{})}):(0,a.jsxs)("div",{className:"p-6 md:p-8 dark:bg-gray-900/50 min-h-full",children:[(0,a.jsxs)(g.E.div,{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Broadcasts"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Send campaigns to tagged groups of customers."})]}),(0,a.jsxs)("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md flex items-center shadow-sm hover:bg-blue-700",children:[(0,a.jsx)(l.Z,{size:16,className:"mr-2"})," New Broadcast"]})]}),0===e.length?(0,a.jsxs)("div",{className:"text-center py-20 border-2 border-dashed rounded-lg",children:[(0,a.jsx)(i.Z,{size:48,className:"mx-auto text-gray-400"}),(0,a.jsx)("h3",{className:"mt-2 text-lg font-medium text-gray-800 dark:text-gray-200",children:"No Broadcasts Sent"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Click 'New Broadcast' to create your first campaign."})]}):(0,a.jsx)(g.E.div,{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recipients"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sent At"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)(g.E.tbody,{className:"divide-y dark:divide-gray-700",children:(0,a.jsx)(y.M,{children:e.map(e=>{var t;return(0,a.jsxs)(g.E.tr,{children:[(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,a.jsx)("p",{className:"text-sm truncate max-w-xs",children:e.message})}),(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:e.status}),(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(null===(t=e._count)||void 0===t?void 0:t.recipients)||0}),(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(0,d.WU)(new Date(e.sentAt),"PPp")}),(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(0,a.jsx)(u.default,{href:"/broadcasts/".concat(e.id),className:"text-blue-600 hover:underline",children:"View"})})]},e.id)})})})]})}),(0,a.jsx)(h,{isOpen:o,onClose:()=>m(!1),onSuccess:()=>{m(!1),x()}})]})}},8274:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(7437),r=s(2265),l=s(3274);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s(8030).Z)("CloudUpload",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]);var n=e=>{let{initialUrl:t,onUpload:s,isQrCode:n=!1}=e,[d,c]=(0,r.useState)(t),[o,m]=(0,r.useState)(!1),[x,p]=(0,r.useState)(""),h=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){m(!0),p("");try{let e=new FormData;e.append("file",a);let t=await fetch("/api/uploads/file",{method:"POST",body:e}),r=await t.json();if(!t.ok)throw Error(r.error||"Upload failed");c(r.url),s(r.url)}catch(e){p(e.message)}finally{m(!1)}}};return(0,a.jsxs)("div",{children:[d?(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("img",{src:d,alt:"preview",className:"border rounded-md p-1 bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 ".concat(n?"h-32 w-32":"h-16"," object-contain")}),(0,a.jsxs)("label",{className:"text-sm font-medium text-blue-600 hover:text-blue-700 cursor-pointer",children:["Change",(0,a.jsx)("input",{type:"file",accept:"image/png, image/jpeg",onChange:h,className:"hidden"})]})]}):(0,a.jsx)("label",{className:"w-full flex flex-col items-center justify-center px-4 py-6 bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Z,{className:"animate-spin h-8 w-8"}),(0,a.jsx)("span",{className:"mt-2 text-sm font-medium",children:"Uploading..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i,{className:"h-8 w-8"}),(0,a.jsx)("span",{className:"mt-2 text-sm font-medium",children:"Click to upload"}),(0,a.jsx)("span",{className:"text-xs",children:"PNG or JPG"}),(0,a.jsx)("input",{type:"file",accept:"image/png, image/jpeg",onChange:h,className:"hidden"})]})}),x&&(0,a.jsx)("p",{className:"text-xs text-red-500 mt-1",children:x})]})}},3258:function(e,t,s){"use strict";var a=s(7437);s(2265),t.Z=()=>(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8",role:"status","aria-label":"Loading",children:[(0,a.jsxs)("svg",{width:"80",height:"80",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",className:"text-blue-600",children:[(0,a.jsxs)("g",{style:{animation:"vc-pulse-bubble 2.5s infinite ease-in-out",transformOrigin:"center"},children:[(0,a.jsx)("path",{d:"M85,50 A35,35 0 1,1 15,50 A35,35 0 0,1 85,50 Z",fill:"currentColor",fillOpacity:"0.1"}),(0,a.jsx)("path",{d:"M20,70 Q30,85 40,70 L20,70 Z",fill:"currentColor",fillOpacity:"0.1"})]}),(0,a.jsx)("path",{style:{strokeDasharray:90,strokeDashoffset:90,animation:"vc-draw-v 1.5s ease-out forwards infinite"},d:"M30 35 L 50 58 L 70 35",stroke:"currentColor",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"}),(0,a.jsxs)("g",{className:"text-gray-400",fill:"currentColor",children:[(0,a.jsx)("circle",{style:{animation:"vc-blink-ellipsis 1.4s infinite 0s"},cx:"38",cy:"72",r:"3"}),(0,a.jsx)("circle",{style:{animation:"vc-blink-ellipsis 1.4s infinite 0.2s"},cx:"50",cy:"72",r:"3"}),(0,a.jsx)("circle",{style:{animation:"vc-blink-ellipsis 1.4s infinite 0.4s"},cx:"62",cy:"72",r:"3"})]})]}),(0,a.jsx)("p",{className:"text-gray-500 mt-2 text-sm font-medium animate-pulse",children:"Connecting..."})]})},5260:function(e,t,s){"use strict";var a=s(7437);s(2265),t.Z=e=>{let{isOpen:t,onClose:s,title:r,children:l}=e;return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",onClick:s,children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md m-4",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:r}),(0,a.jsx)("button",{onClick:s,className:"text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:"\xd7"})]}),(0,a.jsx)("div",{className:"p-4",children:l})]})}):null}}},function(e){e.O(0,[862,138,792,292,971,23,744],function(){return e(e.s=441)}),_N_E=e.O()}]);