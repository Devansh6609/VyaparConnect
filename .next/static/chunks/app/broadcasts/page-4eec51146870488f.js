(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{441:function(e,t,a){Promise.resolve().then(a.bind(a,6981))},2513:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8030).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5404:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8030).Z)("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},994:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(8030).Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},6981:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(7437),r=a(2265),l=a(2513),i=a(5404),n=a(3258),d=a(4919),c=a(5260);let o=(0,a(8030).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var m=a(3274),x=a(994),p=a(8274),h=e=>{let{isOpen:t,onClose:a,onSuccess:l}=e,[i,n]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[u,g]=(0,r.useState)(""),[y,f]=(0,r.useState)(""),[j,b]=(0,r.useState)(null),[N,k]=(0,r.useState)(!1),[w,v]=(0,r.useState)("");(0,r.useEffect)(()=>{t&&((async()=>{let e=await fetch("/api/tags");e.ok&&n(await e.json())})(),h([]),g(""),f(""),v(""),b(null))},[t]);let C=async e=>{if(e.preventDefault(),0===d.length){v("Please select at least one target tag.");return}if(!j&&!y){v("A Template Name is required for text-only broadcasts.");return}k(!0),v("");try{let e=await fetch("/api/broadcasts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tagIds:d,message:u,templateId:y,imageUrl:j})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to send broadcast.");l()}catch(e){v(e.message)}finally{k(!1)}};return(0,s.jsx)(c.Z,{isOpen:t,onClose:a,title:"Create New Broadcast",children:(0,s.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[w&&(0,s.jsx)("p",{className:"text-red-600 bg-red-50 p-2 rounded-md text-sm",children:w}),(0,s.jsxs)("div",{className:"p-3 bg-yellow-50 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-md text-sm flex items-start",children:[(0,s.jsx)(o,{className:"w-8 h-8 mr-2 flex-shrink-0"}),(0,s.jsxs)("span",{children:[(0,s.jsx)("b",{children:"Important:"})," To comply with WhatsApp policies, you must send a pre-approved Meta Template Message for text-only broadcasts."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Target Audience (Tags)"}),(0,s.jsx)("div",{className:"mt-2 border rounded-md max-h-32 overflow-y-auto p-2 space-y-1",children:i.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2 p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:d.includes(e.id),onChange:()=>h(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),className:"h-4 w-4 text-blue-600 rounded"}),(0,s.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Image (Optional)"}),(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(p.Z,{onUpload:e=>b(e),initialUrl:j})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"template-id",className:"flex items-center text-sm font-medium",children:"Template Name / ID"}),(0,s.jsx)("input",{id:"template-id",type:"text",value:y,onChange:e=>f(e.target.value),required:!j,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g., hello_world (required if no image)"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"message",className:"text-sm font-medium",children:"Message Content / Caption"}),(0,s.jsx)("textarea",{id:"message",value:u,onChange:e=>g(e.target.value),rows:4,required:!0,className:"mt-1 w-full border rounded-md p-2 text-sm dark:bg-gray-700 dark:border-gray-600",placeholder:j?"Enter a caption for your image...":"This message text must EXACTLY match your approved template content."})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,s.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm border dark:border-gray-600 rounded-md",children:"Cancel"}),(0,s.jsxs)("button",{type:"submit",disabled:N,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md disabled:opacity-50 flex items-center",children:[N?(0,s.jsx)(m.Z,{className:"animate-spin mr-2"}):(0,s.jsx)(x.Z,{size:16,className:"mr-2"}),"Send Broadcast"]})]})]})})},u=a(7138),g=a(3763),y=a(5348),f=()=>{let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)(!0),[o,m]=(0,r.useState)(!1),x=(0,r.useCallback)(async()=>{c(!0);try{let e=await fetch("/api/broadcasts");e.ok&&t(await e.json())}catch(e){console.error("Failed to fetch broadcasts",e)}finally{c(!1)}},[]);return((0,r.useEffect)(()=>{x()},[x]),a)?(0,s.jsx)("div",{className:"p-8 text-center flex items-center justify-center h-full",children:(0,s.jsx)(n.Z,{})}):(0,s.jsxs)("div",{className:"p-6 md:p-8 dark:bg-gray-900/50 min-h-full",children:[(0,s.jsxs)(g.E.div,{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Broadcasts"}),(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Send campaigns to tagged groups of customers."})]}),(0,s.jsxs)("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md flex items-center shadow-sm hover:bg-blue-700",children:[(0,s.jsx)(l.Z,{size:16,className:"mr-2"})," New Broadcast"]})]}),0===e.length?(0,s.jsxs)("div",{className:"text-center py-20 border-2 border-dashed rounded-lg",children:[(0,s.jsx)(i.Z,{size:48,className:"mx-auto text-gray-400"}),(0,s.jsx)("h3",{className:"mt-2 text-lg font-medium text-gray-800 dark:text-gray-200",children:"No Broadcasts Sent"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Click 'New Broadcast' to create your first campaign."})]}):(0,s.jsx)(g.E.div,{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 overflow-hidden",children:(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recipients"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sent At"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)(g.E.tbody,{className:"divide-y dark:divide-gray-700",children:(0,s.jsx)(y.M,{children:e.map(e=>{var t;return(0,s.jsxs)(g.E.tr,{children:[(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,s.jsx)("p",{className:"text-sm truncate max-w-xs",children:e.message})}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:e.status}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(null===(t=e._count)||void 0===t?void 0:t.recipients)||0}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(0,d.WU)(new Date(e.sentAt),"PPp")}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(0,s.jsx)(u.default,{href:"/broadcasts/".concat(e.id),className:"text-blue-600 hover:underline",children:"View"})})]},e.id)})})})]})}),(0,s.jsx)(h,{isOpen:o,onClose:()=>m(!1),onSuccess:()=>{m(!1),x()}})]})}},8274:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(7437),r=a(2265),l=a(3274);let i=(0,a(8030).Z)("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);var n=e=>{let{initialUrl:t,onUpload:a,isQrCode:n=!1}=e,[d,c]=(0,r.useState)(t),[o,m]=(0,r.useState)(!1),[x,p]=(0,r.useState)(""),h=async e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){m(!0),p("");try{let e=new FormData;e.append("file",s);let t=await fetch("/api/uploads/file",{method:"POST",body:e}),r=await t.json();if(!t.ok)throw Error(r.error||"Upload failed");c(r.url),a(r.url)}catch(e){p(e.message)}finally{m(!1)}}};return(0,s.jsxs)("div",{children:[d?(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("img",{src:d,alt:"preview",className:"border rounded-md p-1 bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 ".concat(n?"h-32 w-32":"h-16"," object-contain")}),(0,s.jsxs)("label",{className:"text-sm font-medium text-blue-600 hover:text-blue-700 cursor-pointer",children:["Change",(0,s.jsx)("input",{type:"file",accept:"image/png, image/jpeg",onChange:h,className:"hidden"})]})]}):(0,s.jsx)("label",{className:"w-full flex flex-col items-center justify-center px-4 py-6 bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{className:"animate-spin h-8 w-8"}),(0,s.jsx)("span",{className:"mt-2 text-sm font-medium",children:"Uploading..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{className:"h-8 w-8"}),(0,s.jsx)("span",{className:"mt-2 text-sm font-medium",children:"Click to upload"}),(0,s.jsx)("span",{className:"text-xs",children:"PNG or JPG"}),(0,s.jsx)("input",{type:"file",accept:"image/png, image/jpeg",onChange:h,className:"hidden"})]})}),x&&(0,s.jsx)("p",{className:"text-xs text-red-500 mt-1",children:x})]})}},3258:function(e,t,a){"use strict";var s=a(7437);a(2265),t.Z=()=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8",role:"status","aria-label":"Loading",children:[(0,s.jsxs)("svg",{width:"80",height:"80",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",className:"text-blue-600",children:[(0,s.jsxs)("g",{style:{animation:"vc-pulse-bubble 2.5s infinite ease-in-out",transformOrigin:"center"},children:[(0,s.jsx)("path",{d:"M85,50 A35,35 0 1,1 15,50 A35,35 0 0,1 85,50 Z",fill:"currentColor",fillOpacity:"0.1"}),(0,s.jsx)("path",{d:"M20,70 Q30,85 40,70 L20,70 Z",fill:"currentColor",fillOpacity:"0.1"})]}),(0,s.jsx)("path",{style:{strokeDasharray:90,strokeDashoffset:90,animation:"vc-draw-v 1.5s ease-out forwards infinite"},d:"M30 35 L 50 58 L 70 35",stroke:"currentColor",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"}),(0,s.jsxs)("g",{className:"text-gray-400",fill:"currentColor",children:[(0,s.jsx)("circle",{style:{animation:"vc-blink-ellipsis 1.4s infinite 0s"},cx:"38",cy:"72",r:"3"}),(0,s.jsx)("circle",{style:{animation:"vc-blink-ellipsis 1.4s infinite 0.2s"},cx:"50",cy:"72",r:"3"}),(0,s.jsx)("circle",{style:{animation:"vc-blink-ellipsis 1.4s infinite 0.4s"},cx:"62",cy:"72",r:"3"})]})]}),(0,s.jsx)("p",{className:"text-gray-500 mt-2 text-sm font-medium animate-pulse",children:"Connecting..."})]})},5260:function(e,t,a){"use strict";var s=a(7437);a(2265),t.Z=e=>{let{isOpen:t,onClose:a,title:r,children:l}=e;return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",onClick:a,children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md m-4",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:r}),(0,s.jsx)("button",{onClick:a,className:"text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:"\xd7"})]}),(0,s.jsx)("div",{className:"p-4",children:l})]})}):null}}},function(e){e.O(0,[620,138,334,482,971,23,744],function(){return e(e.s=441)}),_N_E=e.O()}]);